<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coyahue Helpdesk</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            color-scheme: dark;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle at top left, rgba(110, 11, 212, 0.6), transparent 40%),
                        radial-gradient(circle at bottom right, rgba(0, 245, 212, 0.55), transparent 45%),
                        linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .aurora {
            position: fixed;
            inset: -35vh -35vw;
            background: conic-gradient(from 90deg, rgba(255, 0, 122, 0.35), rgba(0, 255, 242, 0.45), rgba(255, 255, 0, 0.35), rgba(255, 0, 122, 0.35));
            filter: blur(130px);
            animation: rotate 24s linear infinite;
            z-index: 0;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .container {
            position: relative;
            z-index: 1;
            text-align: center;
            padding: 4.5rem 4rem;
            border-radius: 38px;
            background: rgba(15, 23, 42, 0.78);
            border: 1px solid rgba(148, 163, 184, 0.35);
            backdrop-filter: blur(18px);
            box-shadow: 0 40px 90px rgba(15, 23, 42, 0.55);
            max-width: 720px;
            width: min(92vw, 720px);
        }

        h1 {
            font-size: clamp(2.8rem, 4.5vw + 1rem, 4.4rem);
            margin-bottom: 3rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            text-shadow: 0 8px 32px rgba(59, 130, 246, 0.35);
        }

        .buttons {
            display: grid;
            gap: 1.2rem;
            grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
        }

        .diagram-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 1.1rem 1.5rem;
            border-radius: 16px;
            font-weight: 600;
            letter-spacing: 0.06em;
            text-decoration: none;
            color: #0f172a;
            background: linear-gradient(135deg, #facc15, #f472b6);
            box-shadow: 0 18px 45px rgba(250, 204, 21, 0.45);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .diagram-button::before {
            content: "";
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.35);
            clip-path: polygon(0 0, 100% 0, 75% 100%, 0% 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .diagram-button:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 28px 55px rgba(244, 114, 182, 0.6);
        }

        .diagram-button:hover::before {
            opacity: 0.45;
        }

        .panels {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            background: rgba(8, 15, 35, 0.82);
            backdrop-filter: blur(16px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.45s ease;
            z-index: 5;
        }

        .panels.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .panel {
            width: min(1500px, calc(100vw - 72px));
            height: min(940px, calc(100vh - 72px));
            border-radius: 28px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            background: linear-gradient(160deg, rgba(15, 23, 42, 0.94), rgba(17, 24, 39, 0.88));
            box-shadow: 0 45px 100px rgba(15, 23, 42, 0.65);
            transform: translateY(40px) scale(0.96);
            opacity: 0;
            transition: transform 0.5s cubic-bezier(.16,.84,.44,1), opacity 0.5s ease;
            display: none;
            overflow: hidden;
        }

        .panel.active {
            display: flex;
            flex-direction: column;
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.6rem 2.4rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.25);
            flex-shrink: 0;
        }

        .panel-header h2 {
            margin: 0;
            font-size: 1.9rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .back-button {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.5);
            color: rgba(226, 232, 240, 0.92);
            padding: 0.65rem 1.6rem;
            border-radius: 999px;
            cursor: pointer;
            font-weight: 500;
            letter-spacing: 0.08em;
            transition: background 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
        }

        .back-button:hover {
            background: rgba(59, 130, 246, 0.25);
            color: #fff;
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.35);
        }

        .panel-body {
            flex: 1;
            padding: 2rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .panel-body > * {
            flex: 1;
            min-height: 0;
        }

        .diagram-wrapper {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .diagram-wrapper svg {
            width: 100%;
            height: auto;
            max-height: 100%;
            background: rgba(15, 23, 42, 0.45);
            border: 1px solid rgba(96, 165, 250, 0.32);
            border-radius: 26px;
        }

        .usecase-layout {
            display: grid;
            grid-template-columns: minmax(460px, 1fr) minmax(240px, 320px);
            gap: 1.5rem;
            height: 100%;
            min-height: 0;
            align-items: center;
        }

        .usecase-diagram {
            position: relative;
            border-radius: 24px;
            border: 1px solid rgba(129, 140, 248, 0.35);
            background: rgba(30, 27, 75, 0.55);
            padding: 1rem;
            min-height: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #usecase-svg {
            width: 100%;
            height: auto;
            max-height: 100%;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem 1.4rem;
            padding: 1.2rem 1.4rem;
            border-radius: 18px;
            background: rgba(30, 41, 59, 0.55);
            border: 1px solid rgba(96, 165, 250, 0.32);
            font-size: 0.9rem;
        }

        .legend span {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
        }

        .legend span::before {
            content: "";
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 999px;
        }

        .legend .public::before { background: #38bdf8; }
        .legend .private::before { background: #22d3ee; }
        .legend .security::before { background: #f97316; }
        .legend .data::before { background: #34d399; }

        .deployment-node {
            fill: rgba(12, 74, 110, 0.32);
            stroke: rgba(125, 211, 252, 0.55);
            stroke-width: 2.4;
        }

        .deployment-subnet {
            fill: rgba(14, 116, 144, 0.18);
            stroke: rgba(125, 211, 252, 0.45);
            stroke-width: 2;
            stroke-dasharray: 12 10;
        }

        .deployment-text {
            fill: rgba(226, 232, 240, 0.95);
            font-size: 16px;
            font-weight: 500;
        }

        .deployment-detail {
            fill: rgba(148, 163, 184, 0.9);
            font-size: 13px;
        }

        .link {
            stroke: rgba(96, 165, 250, 0.75);
            stroke-width: 2.6;
            fill: none;
            stroke-linecap: round;
            stroke-dasharray: 6 10;
            opacity: 0.2;
            animation: flow 5s linear infinite;
        }

        .link.emphasized {
            opacity: 0.9;
            stroke-dasharray: 14 8;
            animation: pulse 2.4s ease-in-out infinite;
        }

        @keyframes flow {
            from { stroke-dashoffset: 0; }
            to { stroke-dashoffset: -200; }
        }

        @keyframes pulse {
            0%, 100% { stroke-dashoffset: 0; opacity: 0.4; }
            50% { stroke-dashoffset: -40; opacity: 0.95; }
        }

        .actor {
            cursor: pointer;
            transition: transform 0.4s ease, filter 0.4s ease;
        }

        .actor:hover {
            transform: translateY(-6px);
            filter: drop-shadow(0 10px 20px rgba(192, 132, 252, 0.45));
        }

        .actor.active {
            filter: drop-shadow(0 0 18px rgba(192, 132, 252, 0.75));
        }

        .actor-hitzone {
            pointer-events: all;
            fill: rgba(165, 180, 252, 0.18);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .actor:hover .actor-hitzone,
        .actor.active .actor-hitzone {
            opacity: 0.45;
        }

        .usecase {
            fill: rgba(59, 130, 246, 0.18);
            stroke: rgba(96, 165, 250, 0.8);
            stroke-width: 2.2;
            transition: transform 0.35s ease, fill 0.35s ease, stroke 0.35s ease, opacity 0.35s ease;
            opacity: 0.35;
        }

        .usecase-label {
            fill: rgba(226, 232, 240, 0.85);
            font-size: 14px;
            pointer-events: none;
            opacity: 0.35;
            transition: opacity 0.35s ease;
        }

        .usecase.hidden,
        .usecase-label.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .usecase.hidden {
            pointer-events: none;
        }

        .connector {
            stroke: rgba(226, 232, 240, 0.4);
            stroke-width: 2.4;
            fill: none;
            stroke-dasharray: 8 14;
            stroke-linecap: round;
            opacity: 0;
            transition: opacity 0.45s ease;
        }

        .connector.active {
            opacity: 1;
            animation: draw 1.1s ease forwards;
        }

        @keyframes draw {
            from { stroke-dashoffset: 160; }
            to { stroke-dashoffset: 0; }
        }

        .usecase.active {
            fill: rgba(59, 130, 246, 0.35);
            stroke: rgba(125, 211, 252, 0.95);
            transform: scale(1.03);
            opacity: 1;
        }

        .usecase-label.active {
            opacity: 1;
        }

        .include-arrow, .extend-arrow {
            stroke-width: 2;
            fill: none;
        }

        .include-arrow {
            stroke: rgba(250, 204, 21, 0.85);
            stroke-dasharray: 4 6;
            marker-end: url(#include-arrow);
        }

        .extend-arrow {
            stroke: rgba(248, 113, 113, 0.85);
            stroke-dasharray: 3 9;
            marker-end: url(#extend-arrow);
        }

        .relation-label {
            fill: rgba(250, 204, 21, 0.9);
            font-size: 12px;
        }

        .extend-label {
            fill: rgba(248, 113, 113, 0.9);
        }

        .relation {
            opacity: 0.35;
            transition: opacity 0.35s ease, visibility 0.35s ease;
        }

        .relation.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .relation.active {
            opacity: 1;
        }

        .usecase-info {
            border-radius: 24px;
            border: 1px solid rgba(99, 102, 241, 0.45);
            background: rgba(30, 41, 59, 0.55);
            padding: 1.8rem;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }

        .usecase-info h3 {
            margin: 0;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: #c4b5fd;
        }

        .usecase-info h4 {
            margin-bottom: 0.35rem;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: rgba(165, 180, 252, 0.95);
            font-size: 0.95rem;
        }

        .usecase-info ul {
            margin: 0;
            padding-left: 1.2rem;
            color: rgba(226, 232, 240, 0.85);
            line-height: 1.6;
        }

        .info-note {
            font-size: 0.9rem;
            color: rgba(226, 232, 240, 0.6);
        }

        .reset-selection {
            align-self: flex-start;
            background: rgba(76, 29, 149, 0.55);
            border: 1px solid rgba(129, 140, 248, 0.5);
            color: #ede9fe;
            padding: 0.5rem 1.3rem;
            border-radius: 999px;
            cursor: pointer;
            letter-spacing: 0.05em;
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }

        .reset-selection:hover {
            background: rgba(99, 102, 241, 0.75);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.35);
        }

        .der-wrapper {
            display: grid;
            gap: 1.5rem;
            height: 100%;
        }

        #der-svg {
            width: 100%;
            height: 100%;
        }

        .entity {
            fill: rgba(59, 130, 246, 0.16);
            stroke: rgba(129, 140, 248, 0.78);
            stroke-width: 2.6;
            rx: 24;
            ry: 24;
        }

        .entity-header {
            fill: rgba(224, 231, 255, 0.95);
            font-size: 16px;
            font-weight: 600;
        }

        .entity-attr {
            fill: rgba(191, 219, 254, 0.9);
            font-size: 13px;
        }

        .relationship-line {
            stroke: rgba(129, 140, 248, 0.85);
            stroke-width: 2.8;
            fill: none;
            marker-end: url(#der-arrow);
        }

        .cardinality {
            fill: rgba(224, 231, 255, 0.9);
            font-size: 12px;
        }

        .relationship-label {
            fill: rgba(165, 180, 252, 0.95);
            font-size: 12px;
        }

        .der-note {
            border-radius: 22px;
            border: 1px solid rgba(129, 140, 248, 0.45);
            background: rgba(30, 64, 175, 0.35);
            padding: 1.6rem 1.8rem;
            color: rgba(226, 232, 240, 0.9);
            line-height: 1.6;
        }

        @media (max-width: 1024px) {
            .panel {
                width: min(960px, 96vw);
            }

            .usecase-layout {
                grid-template-columns: 1fr;
                grid-auto-rows: auto;
            }

            .usecase-info {
                order: -1;
            }
        }

        @media (max-width: 640px) {
            .container {
                padding: 3.2rem 2.4rem;
            }

            .panel-body {
                padding: 1.6rem;
            }

            .panel-header {
                padding: 1.2rem 1.6rem;
            }
        }
    </style>
</head>
<body>
    <div class="aurora"></div>
    <div class="container">
        <h1>Coyahue Helpdesk</h1>
        <div class="buttons">
            <button class="diagram-button" data-panel="deployment">Vista de Despliegue</button>
            <button class="diagram-button" data-panel="usecases">Casos de Uso</button>
            <button class="diagram-button" data-panel="der">DER</button>
        </div>
    </div>

    <div class="panels" id="panels">
        <div class="panel" id="deployment">
            <div class="panel-header">
                <h2>Arquitectura de Despliegue (Físico)</h2>
                <button class="back-button" data-close>Volver</button>
            </div>
            <div class="panel-body">
                <div class="diagram-wrapper">
                    <svg id="deployment-svg" viewBox="0 0 1400 840" aria-labelledby="deploymentTitle deploymentDesc" role="img">
                        <title id="deploymentTitle">Diagrama de despliegue de Coyahue Helpdesk</title>
                        <desc id="deploymentDesc">Componentes físicos, subredes y flujos de red.</desc>
                        <defs>
                            <marker id="arrow-head" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto" markerUnits="strokeWidth">
                                <polygon points="0 0, 10 5, 0 10" fill="rgba(96, 165, 250, 0.9)"></polygon>
                            </marker>
                        </defs>
                        <rect x="80" y="320" width="200" height="200" rx="22" class="deployment-node"></rect>
                        <text x="180" y="368" text-anchor="middle" class="deployment-text">Cliente</text>
                        <text x="180" y="400" text-anchor="middle" class="deployment-detail">Navegador web</text>
                        <text x="180" y="424" text-anchor="middle" class="deployment-detail">TLS · OIDC</text>

                        <circle cx="340" cy="420" r="90" fill="rgba(30, 64, 175, 0.28)" stroke="rgba(96, 165, 250, 0.55)" stroke-width="2.4"></circle>
                        <text x="340" y="396" text-anchor="middle" class="deployment-text">Internet</text>
                        <text x="340" y="428" text-anchor="middle" class="deployment-detail">Gateway público</text>
                        <text x="340" y="448" text-anchor="middle" class="deployment-detail">WAF + CDN opcional</text>

                        <rect x="440" y="120" width="880" height="560" rx="28" fill="rgba(15, 118, 110, 0.12)" stroke="rgba(45, 212, 191, 0.5)" stroke-width="2.6"></rect>
                        <text x="1280" y="150" text-anchor="end" class="deployment-text">AWS VPC privada</text>
                        <text x="1280" y="176" text-anchor="end" class="deployment-detail">CIDR 10.0.0.0/16 · SG segmentados</text>

                        <rect x="480" y="180" width="360" height="460" rx="24" class="deployment-subnet"></rect>
                        <text x="660" y="220" text-anchor="middle" class="deployment-text">Subred Pública</text>
                        <text x="660" y="244" text-anchor="middle" class="deployment-detail">10.0.1.0/24</text>

                        <rect x="880" y="180" width="360" height="460" rx="24" class="deployment-subnet"></rect>
                        <text x="1060" y="220" text-anchor="middle" class="deployment-text">Subred Privada</text>
                        <text x="1060" y="244" text-anchor="middle" class="deployment-detail">10.0.2.0/24</text>

                        <rect x="520" y="260" width="280" height="140" rx="20" class="deployment-node"></rect>
                        <text x="660" y="298" text-anchor="middle" class="deployment-text">EC2 App + Nginx</text>
                        <text x="660" y="324" text-anchor="middle" class="deployment-detail">Terminación TLS · AutoScaling 2x</text>
                        <text x="660" y="346" text-anchor="middle" class="deployment-detail">Gunicorn / Django</text>

                        <rect x="520" y="460" width="280" height="140" rx="20" class="deployment-node"></rect>
                        <text x="660" y="498" text-anchor="middle" class="deployment-text">Servicios de Aplicación</text>
                        <text x="660" y="524" text-anchor="middle" class="deployment-detail">Django REST + Celery</text>
                        <text x="660" y="546" text-anchor="middle" class="deployment-detail">Logs + /media EFS</text>

                        <rect x="920" y="260" width="240" height="140" rx="20" class="deployment-node"></rect>
                        <text x="1040" y="298" text-anchor="middle" class="deployment-text">PostgreSQL</text>
                        <text x="1040" y="324" text-anchor="middle" class="deployment-detail">Puerto 5432</text>
                        <text x="1040" y="346" text-anchor="middle" class="deployment-detail">Multi-AZ + SG DB</text>

                        <rect x="920" y="460" width="240" height="140" rx="20" class="deployment-node"></rect>
                        <text x="1040" y="498" text-anchor="middle" class="deployment-text">Servicios Opcionales</text>
                        <text x="1040" y="524" text-anchor="middle" class="deployment-detail">NAT · S3 · Secrets Manager</text>
                        <text x="1040" y="546" text-anchor="middle" class="deployment-detail">CloudWatch Logs</text>

                        <line x1="280" y1="420" x2="300" y2="420" class="link emphasized" marker-end="url(#arrow-head)"></line>
                        <line x1="430" y1="420" x2="480" y2="300" class="link emphasized" marker-end="url(#arrow-head)"></line>
                        <line x1="700" y1="400" x2="700" y2="460" class="link emphasized" marker-end="url(#arrow-head)"></line>
                        <line x1="800" y1="520" x2="920" y2="520" class="link emphasized" marker-end="url(#arrow-head)"></line>
                        <line x1="800" y1="320" x2="920" y2="320" class="link emphasized" marker-end="url(#arrow-head)"></line>
                        <line x1="1040" y1="400" x2="1040" y2="460" class="link"></line>
                    </svg>
                    <div class="legend">
                        <span class="public">Subred pública · EC2 App · Nginx/Gunicorn</span>
                        <span class="private">Subred privada · PostgreSQL · NAT</span>
                        <span class="security">Security Groups · TLS en borde · Auditoría</span>
                        <span class="data">Almacenamiento /media · Logs · Métricas</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel" id="usecases">
            <div class="panel-header">
                <h2>Casos de Uso del Sistema</h2>
                <button class="back-button" data-close>Volver</button>
            </div>
            <div class="panel-body">
                <div class="usecase-layout">
                    <div class="usecase-diagram">
                        <svg id="usecase-svg" viewBox="0 0 880 600" aria-labelledby="usecaseTitle usecaseDesc" role="img">
                            <title id="usecaseTitle">Diagrama de casos de uso</title>
                            <desc id="usecaseDesc">Actores solicitante, técnico y administrador con relaciones include/extend.</desc>
                            <defs>
                                <marker id="include-arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto" markerUnits="strokeWidth">
                                    <polygon points="0 0, 8 4, 0 8" fill="rgba(250, 204, 21, 0.85)"></polygon>
                                </marker>
                                <marker id="extend-arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto" markerUnits="strokeWidth">
                                    <polygon points="0 0, 8 4, 0 8" fill="rgba(248, 113, 113, 0.85)"></polygon>
                                </marker>
                            </defs>

                            <g id="usecase-canvas">
                                <rect x="220" y="60" width="520" height="470" rx="24" fill="rgba(30, 64, 175, 0.22)" stroke="rgba(129, 140, 248, 0.7)" stroke-width="2.4"></rect>
                                <text x="480" y="96" text-anchor="middle" fill="rgba(226, 232, 240, 0.85)" font-size="16" letter-spacing="2">Coyahue Helpdesk</text>

                                <g id="actor-solicitante" class="actor" data-actor="solicitante">
                                    <circle class="actor-hitzone" cx="110" cy="210" r="58"></circle>
                                    <circle cx="110" cy="170" r="18" fill="none" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></circle>
                                    <line x1="110" y1="188" x2="110" y2="240" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                    <line x1="82" y1="206" x2="138" y2="206" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                    <line x1="110" y1="240" x2="90" y2="286" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                    <line x1="110" y1="240" x2="132" y2="286" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                    <text x="110" y="310" text-anchor="middle" fill="rgba(196, 181, 253, 0.9)" font-size="15">Solicitante</text>
                                </g>

                                <g id="actor-tecnico" class="actor" data-actor="tecnico">
                                    <circle class="actor-hitzone" cx="110" cy="410" r="58"></circle>
                                    <circle cx="110" cy="370" r="18" fill="none" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></circle>
                                    <line x1="110" y1="388" x2="110" y2="440" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                    <line x1="82" y1="406" x2="138" y2="406" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                    <line x1="110" y1="440" x2="90" y2="486" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                    <line x1="110" y1="440" x2="132" y2="486" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                    <text x="110" y="510" text-anchor="middle" fill="rgba(196, 181, 253, 0.9)" font-size="15">Técnico</text>
                                </g>

                                <g id="actor-administrador" class="actor" data-actor="administrador">
                                    <circle class="actor-hitzone" cx="770" cy="320" r="58"></circle>
                                    <circle cx="770" cy="280" r="18" fill="none" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></circle>
                                    <line x1="770" y1="298" x2="770" y2="350" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                    <line x1="742" y1="316" x2="798" y2="316" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                    <line x1="770" y1="350" x2="752" y2="392" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                    <line x1="770" y1="350" x2="792" y2="392" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                    <text x="770" y="414" text-anchor="middle" fill="rgba(196, 181, 253, 0.9)" font-size="15">Administrador</text>
                                </g>

                                <ellipse id="usecase-login" class="usecase" cx="480" cy="150" rx="90" ry="34"></ellipse>
                                <text class="usecase-label" data-usecase="usecase-login" x="480" y="156" text-anchor="middle">Iniciar / Cerrar sesión</text>

                                <ellipse id="usecase-faq" class="usecase" cx="360" cy="220" rx="90" ry="34"></ellipse>
                                <text class="usecase-label" data-usecase="usecase-faq" x="360" y="226" text-anchor="middle">FAQ autoservicio</text>

                                <ellipse id="usecase-ver" class="usecase" cx="540" cy="220" rx="100" ry="34"></ellipse>
                                <text class="usecase-label" data-usecase="usecase-ver" x="540" y="226" text-anchor="middle">Ver y filtrar tickets</text>

                                <ellipse id="usecase-crear" class="usecase" cx="360" cy="300" rx="100" ry="34"></ellipse>
                                <text class="usecase-label" data-usecase="usecase-crear" x="360" y="306" text-anchor="middle">Crear ticket</text>

                                <ellipse id="usecase-adjuntar" class="usecase" cx="540" cy="300" rx="100" ry="34"></ellipse>
                                <text class="usecase-label" data-usecase="usecase-adjuntar" x="540" y="306" text-anchor="middle">Adjuntar y comentar</text>

                                <ellipse id="usecase-estado" class="usecase" cx="360" cy="380" rx="100" ry="34"></ellipse>
                                <text class="usecase-label" data-usecase="usecase-estado" x="360" y="386" text-anchor="middle">Cambiar estado</text>

                                <ellipse id="usecase-asignar" class="usecase" cx="540" cy="380" rx="100" ry="34"></ellipse>
                                <text class="usecase-label" data-usecase="usecase-asignar" x="540" y="386" text-anchor="middle">Asignar / Reasignar</text>

                                <ellipse id="usecase-dashboard" class="usecase" cx="440" cy="460" rx="105" ry="34"></ellipse>
                                <text class="usecase-label" data-usecase="usecase-dashboard" x="440" y="466" text-anchor="middle">Dashboard KPI</text>

                                <ellipse id="usecase-catalogos" class="usecase" cx="640" cy="280" rx="95" ry="34"></ellipse>
                                <text class="usecase-label" data-usecase="usecase-catalogos" x="640" y="286" text-anchor="middle">Gestionar catálogos</text>

                                <ellipse id="usecase-exportar" class="usecase" cx="640" cy="360" rx="95" ry="34"></ellipse>
                                <text class="usecase-label" data-usecase="usecase-exportar" x="640" y="366" text-anchor="middle">Exportar PDF / Excel</text>

                                <ellipse id="usecase-auditoria" class="usecase" cx="640" cy="440" rx="95" ry="34"></ellipse>
                                <text class="usecase-label" data-usecase="usecase-auditoria" x="640" y="446" text-anchor="middle">Auditoría</text>

                                <ellipse id="usecase-permisos" class="usecase" cx="440" cy="540" rx="105" ry="34"></ellipse>
                                <text class="usecase-label" data-usecase="usecase-permisos" x="440" y="546" text-anchor="middle">Validar permisos por rol</text>

                                <path id="conn-solicitante-login" class="connector" d="M168 210 C244 176, 344 158, 390 152"></path>
                                <path id="conn-solicitante-faq" class="connector" d="M160 216 C240 214, 280 220, 300 222"></path>
                                <path id="conn-solicitante-ver" class="connector" d="M168 222 C248 214, 420 214, 472 220"></path>
                                <path id="conn-solicitante-crear" class="connector" d="M168 230 C244 260, 292 288, 308 300"></path>
                                <path id="conn-solicitante-adjuntar" class="connector" d="M168 236 C260 276, 420 300, 480 300"></path>

                                <path id="conn-tecnico-login" class="connector" d="M168 410 C252 340, 360 250, 420 190"></path>
                                <path id="conn-tecnico-ver" class="connector" d="M168 404 C252 340, 380 260, 450 236"></path>
                                <path id="conn-tecnico-adjuntar" class="connector" d="M168 416 C252 360, 420 308, 480 300"></path>
                                <path id="conn-tecnico-estado" class="connector" d="M168 428 C248 410, 292 388, 312 380"></path>
                                <path id="conn-tecnico-asignar" class="connector" d="M168 432 C280 420, 420 388, 480 380"></path>
                                <path id="conn-tecnico-dashboard" class="connector" d="M168 446 C248 456, 320 462, 360 462"></path>

                                <path id="conn-admin-login" class="connector" d="M720 304 C660 248, 580 190, 520 164"></path>
                                <path id="conn-admin-ver" class="connector" d="M720 312 C660 276, 600 244, 560 232"></path>
                                <path id="conn-admin-asignar" class="connector" d="M720 328 C660 356, 600 378, 560 382"></path>
                                <path id="conn-admin-dashboard" class="connector" d="M720 340 C660 380, 540 440, 500 454"></path>
                                <path id="conn-admin-catalogos" class="connector" d="M720 300 C700 300, 684 288, 664 284"></path>
                                <path id="conn-admin-exportar" class="connector" d="M720 324 C700 332, 684 344, 664 352"></path>
                                <path id="conn-admin-auditoria" class="connector" d="M720 348 C700 372, 684 412, 664 424"></path>
                                <path id="conn-admin-permisos" class="connector" d="M720 356 C660 420, 540 500, 500 520"></path>

                                <g id="rel-faq-crear" class="relation relation-extend" data-usecases="usecase-faq,usecase-crear">
                                    <path class="extend-arrow" d="M360 254 L360 286" marker-end="url(#extend-arrow)"></path>
                                    <text class="relation-label extend-label" x="372" y="272">«extend»</text>
                                </g>

                                <g id="rel-crear-auditoria" class="relation relation-include" data-usecases="usecase-crear,usecase-auditoria">
                                    <path class="include-arrow" d="M376 308 C440 320, 556 348, 608 406" marker-end="url(#include-arrow)"></path>
                                    <text class="relation-label" x="470" y="360">«include»</text>
                                </g>

                                <g id="rel-adjuntar-crear" class="relation relation-extend" data-usecases="usecase-adjuntar,usecase-crear">
                                    <path class="extend-arrow" d="M504 300 L408 300" marker-end="url(#extend-arrow)"></path>
                                    <text class="relation-label extend-label" x="458" y="290">«extend»</text>
                                </g>

                                <g id="rel-adjuntar-auditoria" class="relation relation-include" data-usecases="usecase-adjuntar,usecase-auditoria">
                                    <path class="include-arrow" d="M540 312 C580 332, 620 364, 632 406" marker-end="url(#include-arrow)"></path>
                                    <text class="relation-label" x="584" y="360">«include»</text>
                                </g>

                                <g id="rel-estado-auditoria" class="relation relation-include" data-usecases="usecase-estado,usecase-auditoria">
                                    <path class="include-arrow" d="M360 412 C424 420, 560 420, 612 410" marker-end="url(#include-arrow)"></path>
                                    <text class="relation-label" x="474" y="404">«include»</text>
                                </g>

                                <g id="rel-asignar-auditoria" class="relation relation-include" data-usecases="usecase-asignar,usecase-auditoria">
                                    <path class="include-arrow" d="M540 404 C584 408, 620 412, 636 410" marker-end="url(#include-arrow)"></path>
                                    <text class="relation-label" x="580" y="398">«include»</text>
                                </g>

                                <g id="rel-dashboard-permisos" class="relation relation-include" data-usecases="usecase-dashboard,usecase-permisos">
                                    <path class="include-arrow" d="M440 494 L440 506" marker-end="url(#include-arrow)"></path>
                                    <text class="relation-label" x="454" y="500">«include»</text>
                                </g>

                                <g id="rel-exportar-ver" class="relation relation-include" data-usecases="usecase-exportar,usecase-ver">
                                    <path class="include-arrow" d="M620 344 C592 312, 556 264, 544 244" marker-end="url(#include-arrow)"></path>
                                    <text class="relation-label" x="588" y="302">«include»</text>
                                </g>

                                <g id="rel-catalogos-permisos" class="relation relation-include" data-usecases="usecase-catalogos,usecase-permisos">
                                    <path class="include-arrow" d="M612 288 C556 320, 484 440, 456 506" marker-end="url(#include-arrow)"></path>
                                    <text class="relation-label" x="520" y="420">«include»</text>
                                </g>
                            </g>
                        </svg>
                        <p class="info-note">Pulsa un actor del diagrama para animar sus casos de uso y relaciones.</p>
                    </div>
                    <div class="usecase-info" id="usecase-info">
                        <h3>Selecciona un actor</h3>
                        <p class="info-note">El detalle de casos, relaciones y reglas aparecerá aquí al activar un actor.</p>
                        <button class="reset-selection" id="reset-actors" type="button">Limpiar selección</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel" id="der">
            <div class="panel-header">
                <h2>Diagrama Entidad-Relación</h2>
                <button class="back-button" data-close>Volver</button>
            </div>
            <div class="panel-body">
                <div class="der-wrapper">
                    <svg id="der-svg" viewBox="0 0 1500 1120" aria-labelledby="derTitle derDesc" role="img">
                        <title id="derTitle">DER Coyahue Helpdesk</title>
                        <desc id="derDesc">Entidades de soporte, catálogos, tickets y automatizaciones SLA.</desc>
                        <defs>
                            <marker id="der-arrow" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto" markerUnits="strokeWidth">
                                <polygon points="0 0, 10 5, 0 10" fill="rgba(129, 140, 248, 0.9)"></polygon>
                            </marker>
                        </defs>

                        <rect x="100" y="80" width="260" height="190" class="entity"></rect>
                        <text x="230" y="120" text-anchor="middle" class="entity-header">auth_user</text>
                        <text x="120" y="150" class="entity-attr">• id (PK)</text>
                        <text x="120" y="170" class="entity-attr">• username, email, password</text>
                        <text x="120" y="190" class="entity-attr">• is_active, is_staff, is_superuser</text>
                        <text x="120" y="210" class="entity-attr">• date_joined, last_login</text>

                        <rect x="100" y="320" width="280" height="210" class="entity"></rect>
                        <text x="240" y="360" text-anchor="middle" class="entity-header">SupportProfile</text>
                        <text x="120" y="390" class="entity-attr">• id (PK)</text>
                        <text x="120" y="410" class="entity-attr">• user_id (FK)</text>
                        <text x="120" y="430" class="entity-attr">• area_id (FK)</text>
                        <text x="120" y="450" class="entity-attr">• role, skillset_json</text>
                        <text x="120" y="470" class="entity-attr">• is_on_call</text>

                        <rect x="100" y="580" width="240" height="180" class="entity"></rect>
                        <text x="220" y="620" text-anchor="middle" class="entity-header">Area</text>
                        <text x="120" y="650" class="entity-attr">• id (PK)</text>
                        <text x="120" y="670" class="entity-attr">• name</text>
                        <text x="120" y="690" class="entity-attr">• description</text>
                        <text x="120" y="710" class="entity-attr">• is_active</text>

                        <rect x="100" y="820" width="280" height="200" class="entity"></rect>
                        <text x="240" y="860" text-anchor="middle" class="entity-header">KnowledgeBaseArticle</text>
                        <text x="120" y="890" class="entity-attr">• id (PK)</text>
                        <text x="120" y="910" class="entity-attr">• title</text>
                        <text x="120" y="930" class="entity-attr">• body</text>
                        <text x="120" y="950" class="entity-attr">• category_id (FK)</text>
                        <text x="120" y="970" class="entity-attr">• author_id (FK)</text>
                        <text x="120" y="990" class="entity-attr">• published_at</text>

                        <rect x="440" y="80" width="240" height="180" class="entity"></rect>
                        <text x="560" y="120" text-anchor="middle" class="entity-header">Category</text>
                        <text x="460" y="150" class="entity-attr">• id (PK)</text>
                        <text x="460" y="170" class="entity-attr">• name (UNIQUE)</text>
                        <text x="460" y="190" class="entity-attr">• description</text>
                        <text x="460" y="210" class="entity-attr">• is_active</text>

                        <rect x="780" y="80" width="260" height="200" class="entity"></rect>
                        <text x="910" y="120" text-anchor="middle" class="entity-header">Subcategory</text>
                        <text x="800" y="150" class="entity-attr">• id (PK)</text>
                        <text x="800" y="170" class="entity-attr">• category_id (FK)</text>
                        <text x="800" y="190" class="entity-attr">• name</text>
                        <text x="800" y="210" class="entity-attr">• description</text>
                        <text x="800" y="230" class="entity-attr">• is_active</text>

                        <rect x="1100" y="80" width="220" height="180" class="entity"></rect>
                        <text x="1210" y="120" text-anchor="middle" class="entity-header">Priority</text>
                        <text x="1120" y="150" class="entity-attr">• id (PK)</text>
                        <text x="1120" y="170" class="entity-attr">• name</text>
                        <text x="1120" y="190" class="entity-attr">• color</text>
                        <text x="1120" y="210" class="entity-attr">• level (LOW|MED|HIGH)</text>

                        <rect x="1100" y="320" width="280" height="210" class="entity"></rect>
                        <text x="1240" y="360" text-anchor="middle" class="entity-header">ServiceLevelAgreement</text>
                        <text x="1120" y="390" class="entity-attr">• id (PK)</text>
                        <text x="1120" y="410" class="entity-attr">• name</text>
                        <text x="1120" y="430" class="entity-attr">• response_minutes</text>
                        <text x="1120" y="450" class="entity-attr">• resolution_minutes</text>
                        <text x="1120" y="470" class="entity-attr">• escalation_policy</text>

                        <rect x="540" y="560" width="360" height="240" class="entity"></rect>
                        <text x="720" y="600" text-anchor="middle" class="entity-header">Ticket</text>
                        <text x="560" y="630" class="entity-attr">• id (PK)</text>
                        <text x="560" y="650" class="entity-attr">• title, description</text>
                        <text x="560" y="670" class="entity-attr">• requester_id (FK)</text>
                        <text x="560" y="690" class="entity-attr">• assigned_to_id (FK)</text>
                        <text x="560" y="710" class="entity-attr">• category_id, subcategory_id</text>
                        <text x="560" y="730" class="entity-attr">• priority_id, area_id, sla_id</text>
                        <text x="560" y="750" class="entity-attr">• status, type, sla_state</text>
                        <text x="560" y="770" class="entity-attr">• created_at, updated_at</text>

                        <rect x="960" y="360" width="260" height="200" class="entity"></rect>
                        <text x="1090" y="400" text-anchor="middle" class="entity-header">TicketAssignment</text>
                        <text x="980" y="430" class="entity-attr">• id (PK)</text>
                        <text x="980" y="450" class="entity-attr">• ticket_id (FK)</text>
                        <text x="980" y="470" class="entity-attr">• assignee_id (FK)</text>
                        <text x="980" y="490" class="entity-attr">• assigned_at</text>
                        <text x="980" y="510" class="entity-attr">• reassignment_reason</text>

                        <rect x="960" y="600" width="260" height="200" class="entity"></rect>
                        <text x="1090" y="640" text-anchor="middle" class="entity-header">TicketStatusHistory</text>
                        <text x="980" y="670" class="entity-attr">• id (PK)</text>
                        <text x="980" y="690" class="entity-attr">• ticket_id (FK)</text>
                        <text x="980" y="710" class="entity-attr">• from_status, to_status</text>
                        <text x="980" y="730" class="entity-attr">• changed_by_id (FK)</text>
                        <text x="980" y="750" class="entity-attr">• changed_at</text>

                        <rect x="540" y="840" width="260" height="200" class="entity"></rect>
                        <text x="670" y="880" text-anchor="middle" class="entity-header">TicketComment</text>
                        <text x="560" y="910" class="entity-attr">• id (PK)</text>
                        <text x="560" y="930" class="entity-attr">• ticket_id (FK)</text>
                        <text x="560" y="950" class="entity-attr">• author_id (FK)</text>
                        <text x="560" y="970" class="entity-attr">• body, is_internal</text>
                        <text x="560" y="990" class="entity-attr">• created_at</text>

                        <rect x="820" y="840" width="260" height="200" class="entity"></rect>
                        <text x="950" y="880" text-anchor="middle" class="entity-header">TicketAttachment</text>
                        <text x="840" y="910" class="entity-attr">• id (PK)</text>
                        <text x="840" y="930" class="entity-attr">• ticket_id (FK)</text>
                        <text x="840" y="950" class="entity-attr">• author_id (FK)</text>
                        <text x="840" y="970" class="entity-attr">• file_path</text>
                        <text x="840" y="990" class="entity-attr">• created_at</text>

                        <rect x="1120" y="840" width="260" height="200" class="entity"></rect>
                        <text x="1250" y="880" text-anchor="middle" class="entity-header">Notification</text>
                        <text x="1140" y="910" class="entity-attr">• id (PK)</text>
                        <text x="1140" y="930" class="entity-attr">• ticket_id (FK)</text>
                        <text x="1140" y="950" class="entity-attr">• recipient_id (FK)</text>
                        <text x="1140" y="970" class="entity-attr">• channel (email, web)</text>
                        <text x="1140" y="990" class="entity-attr">• delivered_at, read_at</text>

                        <path class="relationship-line" d="M230 270 L230 320"></path>
                        <text x="212" y="298" class="cardinality">1</text>
                        <text x="246" y="308" class="cardinality">0..1</text>
                        <text x="252" y="286" class="relationship-label">Perfil</text>

                        <path class="relationship-line" d="M220 580 L220 530"></path>
                        <text x="200" y="560" class="cardinality">1</text>
                        <text x="240" y="548" class="cardinality">N</text>
                        <text x="250" y="556" class="relationship-label">Organiza</text>

                        <path class="relationship-line" d="M100 170 L60 170 L60 540 L540 540 L540 560"></path>
                        <text x="92" y="154" class="cardinality">1</text>
                        <text x="548" y="526" class="cardinality">N</text>
                        <text x="84" y="212" class="relationship-label">Solicita</text>

                        <path class="relationship-line" d="M380 425 L380 520 L540 520 L540 560"></path>
                        <text x="392" y="450" class="cardinality">0..N</text>
                        <text x="548" y="500" class="cardinality">1</text>
                        <text x="430" y="508" class="relationship-label">Gestiona</text>

                        <path class="relationship-line" d="M340 670 L520 670"></path>
                        <text x="332" y="656" class="cardinality">1</text>
                        <text x="520" y="656" class="cardinality">N</text>
                        <text x="420" y="650" class="relationship-label">Pertenece</text>

                        <path class="relationship-line" d="M560 260 L560 560"></path>
                        <text x="548" y="300" class="cardinality">1</text>
                        <text x="548" y="540" class="cardinality">N</text>
                        <text x="520" y="360" class="relationship-label">Clasifica</text>

                        <path class="relationship-line" d="M680 260 L780 260"></path>
                        <text x="662" y="250" class="cardinality">1</text>
                        <text x="784" y="250" class="cardinality">N</text>
                        <text x="720" y="240" class="relationship-label">Agrupa</text>

                        <path class="relationship-line" d="M910 280 L910 560"></path>
                        <text x="922" y="320" class="cardinality">1</text>
                        <text x="922" y="540" class="cardinality">N</text>
                        <text x="940" y="420" class="relationship-label">Detalla</text>

                        <path class="relationship-line" d="M1210 260 L1210 320"></path>
                        <text x="1198" y="250" class="cardinality">1</text>
                        <text x="1228" y="304" class="cardinality">1</text>
                        <text x="1238" y="278" class="relationship-label">Define SLA</text>

                        <path class="relationship-line" d="M1240 530 L1240 640 L900 640"></path>
                        <text x="1252" y="580" class="cardinality">1</text>
                        <text x="908" y="628" class="cardinality">N</text>
                        <text x="1148" y="628" class="relationship-label">Controla</text>

                        <path class="relationship-line" d="M960 460 L900 460 L900 560"></path>
                        <text x="972" y="450" class="cardinality">N</text>
                        <text x="908" y="520" class="cardinality">1</text>
                        <text x="930" y="500" class="relationship-label">Historial</text>

                        <path class="relationship-line" d="M380 410 L380 500 L940 500 L940 440"></path>
                        <text x="392" y="470" class="cardinality">1</text>
                        <text x="952" y="460" class="cardinality">N</text>
                        <text x="700" y="488" class="relationship-label">Asignado a</text>

                        <path class="relationship-line" d="M900 680 L960 680"></path>
                        <text x="900" y="666" class="cardinality">1</text>
                        <text x="972" y="666" class="cardinality">N</text>
                        <text x="932" y="660" class="relationship-label">Estados</text>

                        <path class="relationship-line" d="M700 800 L700 840"></path>
                        <text x="688" y="818" class="cardinality">1</text>
                        <text x="708" y="860" class="cardinality">N</text>
                        <text x="718" y="828" class="relationship-label">Comentarios</text>

                        <path class="relationship-line" d="M820 800 L820 840"></path>
                        <text x="808" y="818" class="cardinality">1</text>
                        <text x="828" y="858" class="cardinality">N</text>
                        <text x="838" y="828" class="relationship-label">Adjuntos</text>

                        <path class="relationship-line" d="M900 780 L1120 780 L1120 840"></path>
                        <text x="908" y="768" class="cardinality">1</text>
                        <text x="1132" y="820" class="cardinality">N</text>
                        <text x="1010" y="772" class="relationship-label">Notifica</text>

                        <path class="relationship-line" d="M380 920 L440 920 L440 260"></path>
                        <text x="360" y="900" class="cardinality">N</text>
                        <text x="448" y="280" class="cardinality">1</text>
                        <text x="452" y="540" class="relationship-label">Relacionado</text>
                    </svg>
                    <div class="der-note">
                        SupportProfile extiende los usuarios con roles operativos y disponibilidad por Área; Category y Subcategory estructuran el catálogo mientras Priority enlaza con un ServiceLevelAgreement parametrizable que gobierna los tiempos del Ticket. Las asignaciones, historial de estado, comentarios, adjuntos y notificaciones dependen del Ticket y conservan trazabilidad de actores. El conocimiento publicado vincula soluciones con las categorías para reforzar el autoservicio.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const panelOverlay = document.getElementById('panels');
        const diagramButtons = document.querySelectorAll('.diagram-button');
        const panels = document.querySelectorAll('.panel');
        const closeButtons = document.querySelectorAll('[data-close]');

        diagramButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const panelId = btn.dataset.panel;
                const targetPanel = document.getElementById(panelId);

                panels.forEach(panel => panel.classList.remove('active'));
                panelOverlay.classList.add('visible');
                requestAnimationFrame(() => {
                    targetPanel.classList.add('active');
                    const scrollable = targetPanel.querySelector('.panel-body');
                    if (scrollable) {
                        scrollable.scrollTop = 0;
                    }
                });
            });
        });

        closeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                panels.forEach(panel => panel.classList.remove('active'));
                panelOverlay.classList.remove('visible');
                resetActors();
            });
        });

        panelOverlay.addEventListener('click', event => {
            if (event.target === panelOverlay) {
                panels.forEach(panel => panel.classList.remove('active'));
                panelOverlay.classList.remove('visible');
                resetActors();
            }
        });

        const actorGroups = document.querySelectorAll('.actor');
        const usecaseShapes = document.querySelectorAll('.usecase');
        const usecaseLabels = document.querySelectorAll('.usecase-label');
        const connectors = document.querySelectorAll('.connector');
        const relationGroups = document.querySelectorAll('.relation');
        const usecaseInfo = document.getElementById('usecase-info');
        const initialResetButton = document.getElementById('reset-actors');

        const actorData = {
            solicitante: {
                label: 'Solicitante',
                cases: [
                    'Iniciar sesión / Cerrar sesión',
                    'FAQ autoservicio',
                    'Ver y filtrar tickets',
                    'Crear ticket',
                    'Adjuntar y comentar',
                    'Auditoría (registro automático)'
                ],
                relationships: [
                    'FAQ autoservicio extiende la creación solo si no resuelve la consulta.',
                    'Crear ticket incluye auditoría para garantizar trazabilidad.',
                    'Adjuntar y comentar registra evidencia dentro de auditoría.'
                ],
                rules: [
                    'Tipos permitidos: REQUEST | INCIDENT definidos al crear el ticket.',
                    'Estado inicial OPEN con flujo OPEN → IN_PROGRESS → RESOLVED → CLOSED.',
                    'Adjuntos guardados en /media con AuditLog(action=ATTACH).'
                ],
                usecases: ['usecase-login', 'usecase-faq', 'usecase-ver', 'usecase-crear', 'usecase-adjuntar', 'usecase-auditoria'],
                connectors: [
                    'conn-solicitante-login', 'conn-solicitante-faq', 'conn-solicitante-ver',
                    'conn-solicitante-crear', 'conn-solicitante-adjuntar'
                ]
            },
            tecnico: {
                label: 'Técnico',
                cases: [
                    'Iniciar sesión / Cerrar sesión',
                    'Ver y filtrar tickets',
                    'Adjuntar y comentar',
                    'Cambiar estado',
                    'Asignar / Reasignar',
                    'Dashboard KPI',
                    'Auditoría (registro automático)'
                ],
                relationships: [
                    'Cambiar estado incluye auditoría (registro STATUS).',
                    'Asignar/Reasignar incluye auditoría (registro ASSIGN).',
                    'Dashboard KPI restringido a perfiles con permisos técnicos.',
                    'Adjuntar y comentar alimenta el historial auditado del ticket.'
                ],
                rules: [
                    'Permisos otorgados vía grupos de Django (rol técnico).',
                    'Priority.sla_hours controla eventos SLA_WARN y SLA_BREACH.',
                    'Histórico de asignaciones en TicketAssignment; sincroniza assigned_to.'
                ],
                usecases: [
                    'usecase-login', 'usecase-ver', 'usecase-adjuntar',
                    'usecase-estado', 'usecase-asignar', 'usecase-dashboard',
                    'usecase-auditoria'
                ],
                connectors: [
                    'conn-tecnico-login', 'conn-tecnico-ver', 'conn-tecnico-adjuntar',
                    'conn-tecnico-estado', 'conn-tecnico-asignar', 'conn-tecnico-dashboard'
                ]
            },
            administrador: {
                label: 'Administrador',
                cases: [
                    'Iniciar sesión / Cerrar sesión',
                    'Ver y filtrar tickets',
                    'Asignar / Reasignar',
                    'Dashboard KPI',
                    'Gestionar catálogos',
                    'Exportar PDF / Excel',
                    'Auditoría'
                ],
                relationships: [
                    'Exportar PDF/Excel incluye el resultado filtrado actual.',
                    'Gestionar catálogos incluye validar permisos por rol.',
                    'Auditoría se incluye en acciones críticas.',
                    'Validar permisos controla acceso administrativo.'
                ],
                rules: [
                    'Catálogos normalizados en mayúsculas (Category, Subcategory, Priority, Area).',
                    'Auditoría registra CREATE/ASSIGN/STATUS/COMMENT/ATTACH/SLA.',
                    'Exportar respeta filtros activos del dashboard.'
                ],
                usecases: [
                    'usecase-login', 'usecase-ver', 'usecase-asignar',
                    'usecase-dashboard', 'usecase-catalogos', 'usecase-exportar',
                    'usecase-auditoria', 'usecase-permisos'
                ],
                connectors: [
                    'conn-admin-login', 'conn-admin-ver', 'conn-admin-asignar',
                    'conn-admin-dashboard', 'conn-admin-catalogos', 'conn-admin-exportar',
                    'conn-admin-auditoria', 'conn-admin-permisos'
                ]
            }
        };

        function clearDiagramHighlights() {
            actorGroups.forEach(actor => actor.classList.remove('active'));
            usecaseShapes.forEach(shape => shape.classList.remove('active', 'hidden'));
            usecaseLabels.forEach(label => label.classList.remove('active', 'hidden'));
            connectors.forEach(line => line.classList.remove('active'));
            relationGroups.forEach(group => group.classList.remove('active', 'hidden'));
        }

        function renderActorInfo(actorKey) {
            const data = actorData[actorKey];
            if (!data) return;

            usecaseInfo.innerHTML = `
                <h3>${data.label}</h3>
                <div>
                    <h4>Casos de uso</h4>
                    <ul>${data.cases.map(item => `<li>${item}</li>`).join('')}</ul>
                </div>
                <div>
                    <h4>Relaciones</h4>
                    <ul>${data.relationships.map(item => `<li>${item}</li>`).join('')}</ul>
                </div>
                <div>
                    <h4>Reglas de negocio</h4>
                    <ul>${data.rules.map(item => `<li>${item}</li>`).join('')}</ul>
                </div>
                <button class="reset-selection" id="reset-actors" type="button">Limpiar selección</button>
            `;

            usecaseInfo.querySelector('#reset-actors').addEventListener('click', resetActors);
        }

        function activateActor(actorKey) {
            clearDiagramHighlights();
            const actorElement = document.querySelector(`[data-actor="${actorKey}"]`);
            if (actorElement) {
                actorElement.classList.add('active');
            }

            const data = actorData[actorKey];
            if (!data) return;

            usecaseShapes.forEach(shape => {
                if (data.usecases.includes(shape.id)) {
                    shape.classList.remove('hidden');
                    shape.classList.add('active');
                } else {
                    shape.classList.add('hidden');
                }
            });

            usecaseLabels.forEach(label => {
                if (data.usecases.includes(label.dataset.usecase)) {
                    label.classList.remove('hidden');
                    label.classList.add('active');
                } else {
                    label.classList.add('hidden');
                }
            });

            data.connectors.forEach(id => {
                const connector = document.getElementById(id);
                if (connector) {
                    connector.classList.add('active');
                }
            });

            relationGroups.forEach(group => {
                const relatedIds = (group.dataset.usecases || '').split(',').filter(Boolean);
                const isRelevant = relatedIds.every(id => data.usecases.includes(id));
                if (isRelevant) {
                    group.classList.remove('hidden');
                    group.classList.add('active');
                } else {
                    group.classList.add('hidden');
                }
            });

            renderActorInfo(actorKey);
        }

        function resetActors() {
            clearDiagramHighlights();
            usecaseInfo.innerHTML = `
                <h3>Selecciona un actor</h3>
                <p class="info-note">El detalle de casos, relaciones y reglas aparecerá aquí al activar un actor.</p>
                <button class="reset-selection" id="reset-actors" type="button">Limpiar selección</button>
            `;
            usecaseInfo.querySelector('#reset-actors').addEventListener('click', resetActors);
        }

        actorGroups.forEach(actor => {
            actor.addEventListener('click', () => {
                activateActor(actor.dataset.actor);
            });
        });

        initialResetButton.addEventListener('click', resetActors);
    </script>
</body>
</html>
