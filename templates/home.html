<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coyahue Helpdesk · Diagramas</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            color-scheme: light;
            font-size: 16px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(180deg, #f3f4f6 0%, #e5e7eb 40%, #eef2ff 100%);
            color: #0f172a;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: clamp(1.5rem, 3vw, 3rem);
        }

        .hero {
            position: relative;
            z-index: 1;
            width: min(960px, 100%);
            background: rgba(255, 255, 255, 0.86);
            border: 1px solid rgba(148, 163, 184, 0.45);
            border-radius: 32px;
            padding: clamp(2.5rem, 5vw, 3.75rem);
            box-shadow: 0 35px 80px rgba(15, 23, 42, 0.12);
            text-align: center;
            backdrop-filter: blur(12px);
        }

        h1 {
            font-size: clamp(2.4rem, 3.4vw, 3.2rem);
            margin: 0 0 1rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: #1e3a8a;
        }

        .hero p {
            margin: 0 auto 2.5rem;
            max-width: 640px;
            font-size: 1rem;
            color: #334155;
            line-height: 1.6;
        }

        .buttons {
            display: grid;
            gap: 1.25rem;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        }

        .diagram-button {
            appearance: none;
            border: none;
            border-radius: 18px;
            padding: 1.2rem 1.6rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            color: #f8fafc;
            cursor: pointer;
            box-shadow: 0 18px 36px rgba(79, 70, 229, 0.25);
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }

        .diagram-button:hover {
            transform: translateY(-4px);
            box-shadow: 0 24px 46px rgba(79, 70, 229, 0.3);
        }

        .panels {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.45);
            backdrop-filter: blur(14px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2.5rem 2rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.35s ease;
            z-index: 20;
            overflow: auto;
        }

        .panels.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .panel {
            width: min(1500px, 100vw - 64px);
            max-height: calc(100vh - 96px);
            background: #f8fafc;
            border-radius: 28px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            box-shadow: 0 35px 70px rgba(15, 23, 42, 0.25);
            display: none;
            flex-direction: column;
            overflow: hidden;
            transform: translateY(40px) scale(0.97);
            opacity: 0;
            transition: transform 0.35s ease, opacity 0.35s ease;
        }

        .panel.active {
            display: flex;
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .panel.focus-mode {
            width: min(1740px, 100vw - 40px);
            max-height: calc(100vh - 48px);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.35);
            background: rgba(226, 232, 240, 0.6);
        }

        .panel-header h2 {
            margin: 0;
            font-size: 1.8rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: #1f2937;
        }

        .panel-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .toggle-bar {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .toggle {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            padding: 0.45rem 0.9rem;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.5);
            background: rgba(248, 250, 252, 0.85);
            font-size: 0.82rem;
            color: #1f2937;
        }

        .toggle input {
            accent-color: #2563eb;
            width: 16px;
            height: 16px;
        }

        .panel-body {
            flex: 1;
            min-height: 0;
            display: grid;
            grid-template-columns: minmax(0, 1fr) 320px;
            gap: 1.5rem;
            padding: 1.5rem 1.75rem 1.75rem;
            align-items: stretch;
        }

        .panel-body > * {
            min-height: 0;
        }

        .panel.focus-mode .panel-body {
            grid-template-columns: 1fr;
            padding-right: 1.5rem;
        }

        .panel.focus-mode .side-panel {
            display: none;
        }

        .focus-button,
        .back-button {
            border: 1px solid rgba(148, 163, 184, 0.6);
            border-radius: 999px;
            padding: 0.55rem 1.35rem;
            background: #fff;
            color: #1f2937;
            font-weight: 500;
            letter-spacing: 0.04em;
            cursor: pointer;
            transition: background 0.25s ease, color 0.25s ease, box-shadow 0.25s ease;
        }

        .focus-button:hover,
        .back-button:hover {
            background: #2563eb;
            color: #fff;
            box-shadow: 0 10px 24px rgba(37, 99, 235, 0.25);
        }

        .focus-button.active {
            background: #1e40af;
            color: #f8fafc;
        }

        .diagram-wrapper,
        .usecase-layout,
        .der-wrapper {
            position: relative;
            border: 1px solid rgba(148, 163, 184, 0.35);
            border-radius: 22px;
            background: linear-gradient(180deg, #ffffff 0%, #f5f7fa 100%);
            padding: 1.25rem;
            overflow: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .diagram-wrapper svg,
        .usecase-layout svg,
        .der-wrapper svg {
            width: 100%;
            height: auto;
            flex: 1;
        }

        .usecase-layout {
            gap: 1.25rem;
        }

        .usecase-selector {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }


        .hidden {
            display: none !important;
        }

        .legend {
            margin-top: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            font-size: 0.85rem;
            color: #475569;
        }

        .legend span::before {
            content: "";
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 3px;
            margin-right: 0.5rem;
        }

        .legend .public::before { background: #bfdbfe; }
        .legend .private::before { background: #bbf7d0; }
        .legend .security::before { background: #fde68a; }
        .legend .data::before { background: #c7d2fe; }

        svg text {
            font-family: 'Inter', sans-serif;
            font-size: 16px;
        }

        .entity-header {
            font-weight: 600;
            fill: #0f172a;
        }

        .entity-attr {
            fill: #1f2937;
            font-size: 15px;
        }

        .deployment-node rect,
        .deployment-node ellipse,
        .deployment-node path,
        .deployment-node polygon {
            transition: filter 0.3s ease, opacity 0.3s ease;
        }

        .deployment-link path,
        .deployment-link text {
            transition: opacity 0.3s ease;
        }

        .deployment-link path {
            stroke: #2563eb;
            stroke-width: 3;
            fill: none;
            marker-end: url(#deployment-arrow);
        }

        .deployment-link text {
            font-size: 14px;
            fill: #1e3a8a;
        }

        .link-label {
            fill: #0f172a;
            font-size: 14px;
            font-weight: 600;
        }

        .deployment-link.planned path {
            stroke: #9ca3af;
            stroke-dasharray: 10 8;
            marker-end: url(#deployment-arrow-muted);
        }

        .deployment-node .badge {
            font-size: 12px;
            fill: #1f2937;
        }

        .planned {
            opacity: 0.35;
        }

        .planned.active-planned {
            opacity: 0.65;
        }

        .deployment-node.active {
            filter: drop-shadow(0 0 16px rgba(37, 99, 235, 0.35));
        }

        .deployment-node.dimmed,
        .deployment-link.dimmed {
            opacity: 0.4;
        }

        .side-panel {
            border: 1px solid rgba(148, 163, 184, 0.35);
            border-radius: 22px;
            background: rgba(248, 250, 252, 0.9);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .side-panel h3 {
            margin: 0;
            font-size: 1.1rem;
            letter-spacing: 0.08em;
            color: #1f2937;
            text-transform: uppercase;
        }

        .side-panel-content {
            flex: 1;
            overflow-y: auto;
            color: #334155;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .side-panel-content p {
            margin: 0;
        }
        }

        .actor {
            cursor: pointer;
            transition: opacity 0.3s ease, filter 0.3s ease;
        }

        .actor.active {
            filter: drop-shadow(0 0 18px rgba(37, 99, 235, 0.45));
        }

        .actor.dimmed,
        .usecase.dimmed,
        .usecase-label.dimmed,
        .actor-connector.dimmed,
        .relation-line.dimmed {
            opacity: 0.35;
        }

        .actor-connector {
            stroke: #1d4ed8;
            stroke-width: 2.4;
            fill: none;
            stroke-linejoin: round;
            stroke-dasharray: 6 10;
            stroke-dashoffset: 40;
            transition: opacity 0.3s ease, stroke-dashoffset 0.4s ease;
            marker-end: url(#usecase-arrow);
        }

        .actor-connector.active {
            stroke-dashoffset: 0;
        }

        .usecase {
            fill: #f8fafc;
            stroke: #2563eb;
            stroke-width: 2.2;
        }

        .usecase-label {
            fill: #1f2937;
            font-size: 14px;
        }

        .system-rect {
            fill: rgba(191, 219, 254, 0.32);
            stroke: #2563eb;
            stroke-width: 2;
        }

        .relation-line {
            stroke-width: 2;
            fill: none;
            marker-end: url(#relation-arrow);
            stroke-dashoffset: 24;
            transition: opacity 0.3s ease, stroke-dashoffset 0.4s ease;
        }

        .relation-line.include { stroke: #059669; stroke-dasharray: 8 6; }
        .relation-line.include.active { stroke-dashoffset: 0; }
        .relation-line.exclude { stroke: #dc2626; stroke-dasharray: 4 6; marker-end: none; }

        .note {
            fill: #475569;
            font-size: 13px;
        }

        .usecase-faded {
            opacity: 0;
            pointer-events: none;
        }

        .der-wrapper svg rect {
            fill: #f8fafc;
            stroke: #cbd5f5;
            stroke-width: 2;
            rx: 18;
        }

        .entity-badges {
            fill: #1f2937;
            font-size: 13px;
            font-weight: 600;
        }

        .relationship-line {
            stroke: #1d4ed8;
            stroke-width: 2.6;
            fill: none;
            marker-end: url(#der-arrow);
            transition: opacity 0.3s ease;
        }

        .relationship-line.dimmed,
        .entity.dimmed {
            opacity: 0.4;
        }

        .cardinality {
            fill: #1f2937;
            font-size: 13px;
            font-weight: 600;
        }

        .relationship-label {
            fill: #334155;
            font-size: 13px;
        }

        .der-note {
            fill: #475569;
            font-size: 13px;
        }

        @media (max-width: 1024px) {
            body { padding: 1.5rem; }
            .hero { padding: 2.25rem 1.75rem; }
            .panel {
                width: min(100%, 100vw - 32px);
                height: min(100%, 100vh - 32px);
            }
            .panel-body {
                grid-template-columns: 1fr;
            }
            .side-panel {
                order: -1;
            }
        }
    </style>
</head>
<body>
    <section class="hero">
        <h1>Diagrama del Helpdesk</h1>
        <p>Explora la infraestructura desplegada, los casos de uso clave por actor y el modelo entidad-relación real del sistema de tickets Coyahue. Cada vista admite modo foco, resaltado contextual y elementos planificados.</p>
        <div class="buttons">
            <button class="diagram-button" data-panel="deployment">Vista de Despliegue</button>
            <button class="diagram-button" data-panel="usecases">Casos de Uso</button>
            <button class="diagram-button" data-panel="der">Modelo de Datos</button>
        </div>
    </section>

    <div class="panels" id="panels">
        <!-- VISTA DE DESPLIEGUE -->
        <section class="panel" id="deployment" data-view="deployment">
            <div class="panel-header">
                <h2>Arquitectura de Despliegue</h2>
                <div class="panel-actions">
                    <div class="toggle-bar">
                        <label class="toggle"><input type="checkbox" data-toggle="igw"> Mostrar IGW</label>
                        <label class="toggle"><input type="checkbox" data-toggle="nat"> Mostrar NAT</label>
                        <label class="toggle"><input type="checkbox" data-toggle="s3"> Mostrar S3</label>
                        <label class="toggle"><input type="checkbox" data-toggle="waf"> Mostrar WAF/ALB</label>
                    </div>
                    <button class="focus-button" data-focus>Ampliar diagrama</button>
                    <button class="back-button" data-close>Volver</button>
                </div>
            </div>
            <div class="panel-body">
                <div class="diagram-wrapper">
                    <svg id="deployment-svg" viewBox="0 0 1680 920" role="img" aria-labelledby="deploymentTitle deploymentDesc" preserveAspectRatio="xMidYMid meet">
                        <title id="deploymentTitle">Despliegue Coyahue Helpdesk en AWS</title>
                        <desc id="deploymentDesc">Topología con cliente, internet, VPC en AWS, EC2 con Nginx, Gunicorn y Django, almacenamiento local y PostgreSQL en subred privada.</desc>
                        <defs>
                            <marker id="deployment-arrow" markerWidth="12" markerHeight="12" refX="9" refY="6" orient="auto" markerUnits="strokeWidth">
                                <polygon points="0 0, 12 6, 0 12" fill="#2563eb"></polygon>
                            </marker>
                            <marker id="deployment-arrow-muted" markerWidth="12" markerHeight="12" refX="9" refY="6" orient="auto" markerUnits="strokeWidth">
                                <polygon points="0 0, 12 6, 0 12" fill="#9ca3af"></polygon>
                            </marker>
                        </defs>
                        <g data-node="Cliente" class="deployment-node">
                            <rect x="80" y="350" width="190" height="190" rx="22" fill="#bfdbfe" stroke="#60a5fa" stroke-width="2.4"></rect>
                            <text x="175" y="405" text-anchor="middle" class="entity-header">Cliente</text>
                            <text x="175" y="435" text-anchor="middle" class="entity-attr">Navegador web</text>
                            <text x="175" y="463" text-anchor="middle" class="entity-attr">TLS + Autenticación</text>
                        </g>

                        <g data-node="Internet" class="deployment-node">
                            <path d="M310 360 C300 310 360 280 400 295 C420 250 500 250 520 295 C570 285 610 320 600 360 C640 380 630 430 580 440 C560 480 480 490 450 460 C400 480 340 460 350 415 C300 410 300 370 310 360 Z" fill="#e0e7ff" stroke="#6366f1" stroke-width="2.4"></path>
                            <text x="455" y="358" text-anchor="middle" class="entity-header">Internet</text>
                            <text x="455" y="388" text-anchor="middle" class="entity-attr">Acceso público</text>
                        </g>

                        <g data-node="IGW" class="deployment-node planned hidden" data-toggle-group="igw">
                            <polygon points="600,220 660,220 690,260 660,300 600,300 570,260" fill="#e5e7eb" stroke="#94a3b8" stroke-width="2"></polygon>
                            <text x="605" y="252" text-anchor="middle" class="entity-attr">Internet Gateway</text>
                            <text x="605" y="276" text-anchor="middle" class="badge">Por implementar</text>
                            <title>Se agregará a la tabla de rutas de la subred pública.</title>
                        </g>

                        <g data-node="Entrada VPC" class="deployment-node">
                            <rect x="720" y="340" width="140" height="220" rx="18" fill="#d1fae5" stroke="#34d399" stroke-width="2"></rect>
                            <text x="790" y="390" text-anchor="middle" class="entity-header">Entrada VPC</text>
                            <text x="790" y="420" text-anchor="middle" class="entity-attr">Security Group</text>
                        </g>

                        <g data-node="AWS VPC" class="deployment-node">
                            <rect x="780" y="150" width="840" height="560" rx="28" fill="rgba(191, 219, 254, 0.25)" stroke="#38bdf8" stroke-width="2.6"></rect>
                            <text x="1580" y="190" text-anchor="end" class="entity-header">AWS VPC</text>
                        </g>

                        <g data-node="Subred pública" class="deployment-node">
                            <rect x="820" y="220" width="420" height="440" rx="24" fill="rgba(187, 247, 208, 0.6)" stroke="#4ade80" stroke-width="2"></rect>
                            <text x="1030" y="270" text-anchor="middle" class="entity-header">Subred pública</text>
                        </g>

                        <g data-node="Subred privada" class="deployment-node">
                            <rect x="1280" y="220" width="360" height="440" rx="24" fill="rgba(191, 219, 254, 0.55)" stroke="#60a5fa" stroke-width="2"></rect>
                            <text x="1460" y="270" text-anchor="middle" class="entity-header">Subred privada</text>
                        </g>

                        <g data-node="NAT Gateway" class="deployment-node planned hidden" data-toggle-group="nat">
                            <rect x="1080" y="210" width="150" height="60" rx="14" fill="#f1f5f9" stroke="#94a3b8" stroke-width="2"></rect>
                            <text x="1155" y="242" text-anchor="middle" class="entity-attr">NAT Gateway</text>
                            <text x="1155" y="268" text-anchor="middle" class="badge">Por implementar</text>
                            <title>Para actualizaciones desde la subred privada sin exponer la base de datos.</title>
                        </g>

                        <g data-node="EC2 App" class="deployment-node">
                            <rect x="940" y="330" width="280" height="280" rx="20" fill="#dbeafe" stroke="#60a5fa" stroke-width="2.2"></rect>
                            <line x1="940" y1="390" x2="1220" y2="390" stroke="#94a3b8" stroke-width="1.5"></line>
                            <line x1="940" y1="450" x2="1220" y2="450" stroke="#94a3b8" stroke-width="1.5"></line>
                            <text x="1080" y="360" text-anchor="middle" class="entity-header">EC2 App</text>
                            <text x="1080" y="382" text-anchor="middle" class="entity-attr">Nginx · HTTPS (443)</text>
                            <text x="1080" y="442" text-anchor="middle" class="entity-attr">Gunicorn</text>
                            <text x="1080" y="502" text-anchor="middle" class="entity-attr">Django + DRF</text>
                        </g>

                        <g data-node="WAF/ALB" class="deployment-node planned hidden" data-toggle-group="waf">
                            <rect x="860" y="380" width="70" height="160" rx="18" fill="#f9fafb" stroke="#d1d5db" stroke-width="2"></rect>
                            <text x="895" y="452" text-anchor="middle" class="entity-attr">WAF / ALB</text>
                            <text x="895" y="478" text-anchor="middle" class="badge">Por implementar</text>
                            <title>Seguridad perimetral y balanceo de carga.</title>
                        </g>

                        <g data-node="/media" class="deployment-node">
                            <rect x="1000" y="540" width="100" height="90" rx="14" fill="#ede9fe" stroke="#a855f7" stroke-width="1.8"></rect>
                            <text x="1050" y="585" text-anchor="middle" class="entity-attr">/media</text>
                            <text x="1050" y="610" text-anchor="middle" class="entity-attr">Adjuntos</text>
                        </g>

                        <g data-node="Logs" class="deployment-node">
                            <rect x="1140" y="540" width="100" height="90" rx="14" fill="#ede9fe" stroke="#a855f7" stroke-width="1.8"></rect>
                            <text x="1190" y="585" text-anchor="middle" class="entity-attr">Logs</text>
                            <text x="1190" y="610" text-anchor="middle" class="entity-attr">Aplicación</text>
                        </g>

                        <g data-node="S3" class="deployment-node planned hidden" data-toggle-group="s3">
                            <rect x="1320" y="560" width="170" height="110" rx="18" fill="#f9fafb" stroke="#cbd5f5" stroke-width="2"></rect>
                            <text x="1405" y="605" text-anchor="middle" class="entity-attr">S3 (adjuntos)</text>
                            <text x="1405" y="632" text-anchor="middle" class="badge">Por implementar</text>
                            <title>Migración prevista de /media a S3 mediante django-storages.</title>
                        </g>

                        <g data-node="PostgreSQL" class="deployment-node">
                            <ellipse cx="1460" cy="370" rx="125" ry="65" fill="#bae6fd" stroke="#0ea5e9" stroke-width="2.4"></ellipse>
                            <text x="1460" y="360" text-anchor="middle" class="entity-header">PostgreSQL</text>
                            <text x="1460" y="388" text-anchor="middle" class="entity-attr">Puerto 5432</text>
                        </g>
                        <g data-edge="Cliente-Internet" class="deployment-link" data-source="Cliente" data-target="Internet">
                            <path d="M270 445 H320"></path>
                        </g>

                        <g data-edge="Internet-Entrada" class="deployment-link" data-source="Internet" data-target="Entrada VPC">
                            <path d="M540 445 H720"></path>
                        </g>

                        <g data-edge="Entrada-WAF" class="deployment-link planned hidden" data-toggle-group="waf" data-source="Entrada VPC" data-target="WAF/ALB">
                            <path d="M860 430 H865"></path>
                        </g>
                        <g data-edge="WAF-EC2" class="deployment-link planned hidden" data-toggle-group="waf" data-source="WAF/ALB" data-target="EC2 App">
                            <path d="M930 430 H940"></path>
                        </g>

                        <g data-edge="Entrada-EC2" class="deployment-link" data-source="Entrada VPC" data-target="EC2 App">
                            <path d="M860 430 H940"></path>
                        </g>

                        <g data-edge="EC2-Postgres" class="deployment-link" data-source="EC2 App" data-target="PostgreSQL">
                            <path d="M1220 500 H1320 V370 H1335"></path>
                            <text x="1338" y="332" class="link-label">Tráfico interno VPC</text>
                        </g>

                        <g data-edge="EC2-media" class="deployment-link" data-source="EC2 App" data-target="/media">
                            <path d="M1050 510 V540"></path>
                        </g>

                        <g data-edge="EC2-logs" class="deployment-link" data-source="EC2 App" data-target="Logs">
                            <path d="M1190 510 V540"></path>
                        </g>

                        <g data-edge="Postgres-EC2" class="deployment-link" data-source="PostgreSQL" data-target="EC2 App">
                            <path d="M1585 370 H1620 V560 H1220"></path>
                        </g>

                        <g data-edge="NAT-Privada" class="deployment-link planned hidden" data-toggle-group="nat" data-source="NAT Gateway" data-target="Subred privada">
                            <path d="M1155 210 V190 H1280 V220"></path>
                            <text x="1250" y="198" class="link-label">Salida controlada</text>
                        </g>

                        <g data-edge="Privada-NAT" class="deployment-link planned hidden" data-toggle-group="nat" data-source="Subred privada" data-target="NAT Gateway">
                            <path d="M1280 220 V190 H1155 V210"></path>
                        </g>

                        <g data-edge="Django-S3" class="deployment-link planned hidden" data-toggle-group="s3" data-source="EC2 App" data-target="S3">
                            <path d="M1220 560 H1320"></path>
                        </g>

                        <g data-edge="Internet-IGW" class="deployment-link planned hidden" data-toggle-group="igw" data-source="Internet" data-target="IGW">
                            <path d="M520 320 L600 260"></path>
                        </g>

                        <g data-edge="IGW-Entrada" class="deployment-link planned hidden" data-toggle-group="igw" data-source="IGW" data-target="Entrada VPC">
                            <path d="M690 260 L720 340"></path>
                        </g>

                        <g data-edge="Internet-WAF" class="deployment-link planned hidden" data-toggle-group="waf" data-source="Internet" data-target="WAF/ALB">
                            <path d="M600 445 H860"></path>
                        </g>
                    </svg>
                    <div class="legend">
                        <span class="public">Subred pública · EC2 · Nginx/Gunicorn</span>
                        <span class="private">Subred privada · PostgreSQL</span>
                        <span class="security">TLS · Seguridad</span>
                        <span class="data">/media · Logs</span>
                    </div>
                </div>
                <aside class="side-panel" data-side-panel>
                    <h3 id="deployment-node-title">Cliente</h3>
                    <div class="side-panel-content" id="deployment-panel-content"></div>
                </aside>
            </div>
        </section>
        <!-- VISTA CASOS DE USO -->
        <section class="panel" id="usecases" data-view="usecases">
            <div class="panel-header">
                <h2>Casos de Uso</h2>
                <div class="panel-actions">
                    <button class="focus-button" data-focus>Ampliar diagrama</button>
                    <button class="back-button" data-close>Volver</button>
                </div>
            </div>
            <div class="panel-body">
                <div class="usecase-layout">
                    <div class="usecase-selector">
                        <button class="active" data-actor-filter="todos">Todos</button>
                        <button data-actor-filter="solicitante">Solicitante</button>
                        <button data-actor-filter="tecnico">Técnico</button>
                        <button data-actor-filter="administrador">Administrador</button>
                    </div>
                    <svg id="usecase-svg" viewBox="0 0 1120 760" role="img" aria-labelledby="usecaseTitle usecaseDesc">
                        <title id="usecaseTitle">Casos de uso del sistema de tickets</title>
                        <desc id="usecaseDesc">Actor solicitante, técnico y administrador interactuando con el sistema de tickets y sus funcionalidades clave.</desc>
                        <defs>
                            <marker id="usecase-arrow" markerWidth="10" markerHeight="10" refX="7" refY="5" orient="auto" markerUnits="strokeWidth">
                                <polygon points="0 0, 10 5, 0 10" fill="#1e40af"></polygon>
                            </marker>
                            <marker id="relation-arrow" markerWidth="8" markerHeight="8" refX="6" refY="4" orient="auto" markerUnits="strokeWidth">
                                <polygon points="0 0, 8 4, 0 8" fill="#059669"></polygon>
                            </marker>
                        </defs>

                        <g data-node="Sistema" data-kind="system">
                            <rect class="system-rect" x="320" y="80" width="480" height="560" rx="24"></rect>
                            <text x="560" y="120" text-anchor="middle" class="entity-header">Sistema de Tickets</text>
                        </g>

                        <g class="actor" data-node="Solicitante" data-kind="actor">
                            <circle cx="140" cy="200" r="18" stroke="#2563eb" stroke-width="3" fill="none"></circle>
                            <line x1="140" y1="218" x2="140" y2="270" stroke="#2563eb" stroke-width="3"></line>
                            <line x1="110" y1="230" x2="170" y2="230" stroke="#2563eb" stroke-width="3"></line>
                            <line x1="140" y1="270" x2="118" y2="310" stroke="#2563eb" stroke-width="3"></line>
                            <line x1="140" y1="270" x2="162" y2="310" stroke="#2563eb" stroke-width="3"></line>
                            <text x="140" y="340" text-anchor="middle" class="entity-header">Solicitante</text>
                        </g>

                        <g class="actor" data-node="Técnico" data-kind="actor">
                            <circle cx="140" cy="500" r="18" stroke="#2563eb" stroke-width="3" fill="none"></circle>
                            <line x1="140" y1="518" x2="140" y2="570" stroke="#2563eb" stroke-width="3"></line>
                            <line x1="110" y1="530" x2="170" y2="530" stroke="#2563eb" stroke-width="3"></line>
                            <line x1="140" y1="570" x2="118" y2="610" stroke="#2563eb" stroke-width="3"></line>
                            <line x1="140" y1="570" x2="162" y2="610" stroke="#2563eb" stroke-width="3"></line>
                            <text x="140" y="640" text-anchor="middle" class="entity-header">Técnico</text>
                        </g>

                        <g class="actor" data-node="Administrador" data-kind="actor">
                            <circle cx="980" cy="320" r="18" stroke="#2563eb" stroke-width="3" fill="none"></circle>
                            <line x1="980" y1="338" x2="980" y2="390" stroke="#2563eb" stroke-width="3"></line>
                            <line x1="950" y1="350" x2="1010" y2="350" stroke="#2563eb" stroke-width="3"></line>
                            <line x1="980" y1="390" x2="958" y2="430" stroke="#2563eb" stroke-width="3"></line>
                            <line x1="980" y1="390" x2="1002" y2="430" stroke="#2563eb" stroke-width="3"></line>
                            <text x="980" y="470" text-anchor="middle" class="entity-header">Administrador</text>
                        </g>

                        <g data-node="Iniciar/Cerrar sesión" class="usecase-group">
                            <ellipse class="usecase" cx="560" cy="160" rx="130" ry="36"></ellipse>
                            <text class="usecase-label" data-usecase="Iniciar/Cerrar sesión" x="560" y="166" text-anchor="middle">Iniciar/Cerrar sesión</text>
                        </g>
                        <g data-node="Validar permisos por rol" class="usecase-group">
                            <ellipse class="usecase" cx="560" cy="210" rx="140" ry="36"></ellipse>
                            <text class="usecase-label" data-usecase="Validar permisos por rol" x="560" y="216" text-anchor="middle">Validar permisos por rol</text>
                        </g>
                        <g data-node="FAQ autoservicio" class="usecase-group">
                            <ellipse class="usecase" cx="420" cy="260" rx="120" ry="34"></ellipse>
                            <text class="usecase-label" data-usecase="FAQ autoservicio" x="420" y="266" text-anchor="middle">FAQ autoservicio</text>
                        </g>
                        <g data-node="Ver y filtrar tickets" class="usecase-group">
                            <ellipse class="usecase" cx="700" cy="260" rx="140" ry="34"></ellipse>
                            <text class="usecase-label" data-usecase="Ver y filtrar tickets" x="700" y="266" text-anchor="middle">Ver y filtrar tickets</text>
                        </g>
                        <g data-node="Crear ticket" class="usecase-group">
                            <ellipse class="usecase" cx="420" cy="320" rx="120" ry="34"></ellipse>
                            <text class="usecase-label" data-usecase="Crear ticket" x="420" y="326" text-anchor="middle">Crear ticket</text>
                        </g>
                        <g data-node="Adjuntar y comentar" class="usecase-group">
                            <ellipse class="usecase" cx="700" cy="320" rx="140" ry="34"></ellipse>
                            <text class="usecase-label" data-usecase="Adjuntar y comentar" x="700" y="326" text-anchor="middle">Adjuntar y comentar</text>
                        </g>
                        <g data-node="Cambiar estado" class="usecase-group">
                            <ellipse class="usecase" cx="420" cy="380" rx="120" ry="34"></ellipse>
                            <text class="usecase-label" data-usecase="Cambiar estado" x="420" y="386" text-anchor="middle">Cambiar estado</text>
                        </g>
                        <g data-node="Asignar/Reasignar" class="usecase-group">
                            <ellipse class="usecase" cx="700" cy="380" rx="140" ry="34"></ellipse>
                            <text class="usecase-label" data-usecase="Asignar/Reasignar" x="700" y="386" text-anchor="middle">Asignar/Reasignar</text>
                        </g>
                        <g data-node="Dashboard KPI" class="usecase-group">
                            <ellipse class="usecase" cx="420" cy="440" rx="120" ry="34"></ellipse>
                            <text class="usecase-label" data-usecase="Dashboard KPI" x="420" y="446" text-anchor="middle">Dashboard KPI</text>
                        </g>
                        <g data-node="Exportar PDF/Excel" class="usecase-group">
                            <ellipse class="usecase" cx="700" cy="440" rx="140" ry="34"></ellipse>
                            <text class="usecase-label" data-usecase="Exportar PDF/Excel" x="700" y="446" text-anchor="middle">Exportar PDF/Excel</text>
                        </g>
                        <g data-node="Gestionar catálogos" class="usecase-group">
                            <ellipse class="usecase" cx="420" cy="500" rx="140" ry="34"></ellipse>
                            <text class="usecase-label" data-usecase="Gestionar catálogos" x="420" y="506" text-anchor="middle">Gestionar catálogos</text>
                        </g>
                        <g data-node="Auditoría" class="usecase-group">
                            <ellipse class="usecase" cx="700" cy="500" rx="140" ry="34"></ellipse>
                            <text class="usecase-label" data-usecase="Auditoría" x="700" y="506" text-anchor="middle">Auditoría</text>
                        </g>
                        <path class="actor-connector" data-source="Solicitante" data-target="Iniciar/Cerrar sesión" d="M240 230 H360 V160 H430"></path>
                        <path class="actor-connector" data-source="Solicitante" data-target="FAQ autoservicio" d="M240 230 H300 V260 H300"></path>
                        <path class="actor-connector" data-source="Solicitante" data-target="Ver y filtrar tickets" d="M240 230 H300 V260 H560"></path>
                        <path class="actor-connector" data-source="Solicitante" data-target="Crear ticket" d="M240 230 H300 V320 H300"></path>
                        <path class="actor-connector" data-source="Solicitante" data-target="Adjuntar y comentar" d="M240 230 H300 V320 H560"></path>

                        <path class="actor-connector" data-source="Técnico" data-target="Iniciar/Cerrar sesión" d="M240 530 H300 V160 H430"></path>
                        <path class="actor-connector" data-source="Técnico" data-target="Ver y filtrar tickets" d="M240 530 H300 V260 H560"></path>
                        <path class="actor-connector" data-source="Técnico" data-target="Adjuntar y comentar" d="M240 530 H300 V320 H560"></path>
                        <path class="actor-connector" data-source="Técnico" data-target="Cambiar estado" d="M240 530 H300 V380 H300"></path>
                        <path class="actor-connector" data-source="Técnico" data-target="Asignar/Reasignar" d="M240 530 H300 V380 H560"></path>
                        <path class="actor-connector" data-source="Técnico" data-target="Dashboard KPI" d="M240 530 H300 V440 H300"></path>

                        <path class="actor-connector" data-source="Administrador" data-target="Iniciar/Cerrar sesión" d="M880 350 H780 V160 H690"></path>
                        <path class="actor-connector" data-source="Administrador" data-target="Ver y filtrar tickets" d="M880 350 H820 V260 H780"></path>
                        <path class="actor-connector" data-source="Administrador" data-target="Asignar/Reasignar" d="M880 350 H820 V380 H780"></path>
                        <path class="actor-connector" data-source="Administrador" data-target="Dashboard KPI" d="M880 350 H820 V440 H780"></path>
                        <path class="actor-connector" data-source="Administrador" data-target="Gestionar catálogos" d="M880 350 H820 V500 H780"></path>
                        <path class="actor-connector" data-source="Administrador" data-target="Exportar PDF/Excel" d="M880 350 H820 V440 H780"></path>
                        <path class="actor-connector" data-source="Administrador" data-target="Auditoría" d="M880 350 H820 V500 H780"></path>

                        <path class="relation-line include" data-source="Crear ticket" data-target="Auditoría" d="M420 354 V470 H700"></path>
                        <path class="relation-line include" data-source="Adjuntar y comentar" data-target="Auditoría" d="M700 354 V470"></path>
                        <path class="relation-line include" data-source="Cambiar estado" data-target="Auditoría" d="M420 414 V470 H700"></path>
                        <path class="relation-line include" data-source="Asignar/Reasignar" data-target="Auditoría" d="M700 414 V470"></path>
                        <path class="relation-line include" data-source="Exportar PDF/Excel" data-target="Ver y filtrar tickets" d="M700 474 V300"></path>
                        <path class="relation-line include" data-source="Crear ticket" data-target="Validar permisos por rol" d="M420 286 V230 H560"></path>
                        <path class="relation-line include" data-source="Adjuntar y comentar" data-target="Validar permisos por rol" d="M700 286 V230"></path>
                        <path class="relation-line include" data-source="Cambiar estado" data-target="Validar permisos por rol" d="M420 346 V230 H560"></path>
                        <path class="relation-line include" data-source="Asignar/Reasignar" data-target="Validar permisos por rol" d="M700 346 V230"></path>
                        <path class="relation-line include" data-source="Dashboard KPI" data-target="Validar permisos por rol" d="M420 406 V230 H560"></path>
                        <path class="relation-line include" data-source="Exportar PDF/Excel" data-target="Validar permisos por rol" d="M700 406 V230"></path>
                        <path class="relation-line include" data-source="Gestionar catálogos" data-target="Validar permisos por rol" d="M420 466 V230 H560"></path>
                        <path class="relation-line include" data-source="Auditoría" data-target="Validar permisos por rol" d="M700 466 V230"></path>

                        <text x="780" y="620" class="note">FAQ excluye la creación de ticket cuando resuelve la solicitud.</text>
                    </svg>
                </div>
                <aside class="side-panel" data-side-panel>
                    <h3 id="usecases-node-title">Solicitante</h3>
                    <div class="side-panel-content" id="usecases-panel-content"></div>
                </aside>
            </div>
        </section>
        <!-- VISTA DER -->
        <section class="panel" id="der" data-view="der">
            <div class="panel-header">
                <h2>Diagrama Entidad-Relación</h2>
                <div class="panel-actions">
                    <button class="focus-button" data-focus>Ampliar diagrama</button>
                    <button class="back-button" data-close>Volver</button>
                </div>
            </div>
            <div class="panel-body">
                <div class="der-wrapper">
                    <svg id="der-svg" viewBox="0 0 1680 1180" role="img" aria-labelledby="derTitle derDesc" preserveAspectRatio="xMidYMid meet">
                        <title id="derTitle">Modelo de datos Coyahue Helpdesk</title>
                        <desc id="derDesc">Entidades auth_user, Category, Subcategory, Ticket, Priority, Area y los registros relacionados de comentarios, adjuntos, asignaciones y auditoría.</desc>
                        <defs>
                            <marker id="der-arrow" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto" markerUnits="strokeWidth">
                                <polygon points="0 0, 10 5, 0 10" fill="#2563eb"></polygon>
                            </marker>
                        </defs>

                        <g data-node="auth_user" class="entity" transform="translate(80,120)">
                            <rect width="320" height="220"></rect>
                            <text x="160" y="32" text-anchor="middle" class="entity-header">auth_user</text>
                            <text x="20" y="70" class="entity-badges">PK</text>
                            <text x="20" y="100" class="entity-attr">• id (PK)</text>
                            <text x="20" y="120" class="entity-attr">• username</text>
                            <text x="20" y="140" class="entity-attr">• password (hash)</text>
                            <text x="20" y="160" class="entity-attr">• email</text>
                            <text x="20" y="180" class="entity-attr">• is_active · is_staff</text>
                        </g>

                        <g data-node="Category" class="entity" transform="translate(460,120)">
                            <rect width="300" height="220"></rect>
                            <text x="150" y="32" text-anchor="middle" class="entity-header">Category</text>
                            <text x="20" y="70" class="entity-badges">UNIQUE</text>
                            <text x="20" y="100" class="entity-attr">• id (PK)</text>
                            <text x="20" y="120" class="entity-attr">• name</text>
                            <text x="20" y="140" class="entity-attr">• description</text>
                            <text x="20" y="160" class="entity-attr">• is_active</text>
                            <text x="20" y="180" class="entity-attr">Nota: nombres normalizados en MAYÚSCULAS</text>
                        </g>

                        <g data-node="Subcategory" class="entity" transform="translate(840,120)">
                            <rect width="320" height="240"></rect>
                            <text x="160" y="32" text-anchor="middle" class="entity-header">Subcategory</text>
                            <text x="20" y="70" class="entity-badges">FK</text>
                            <text x="20" y="100" class="entity-attr">• id (PK)</text>
                            <text x="20" y="120" class="entity-attr">• category_id (FK)</text>
                            <text x="20" y="140" class="entity-attr">• name</text>
                            <text x="20" y="160" class="entity-attr">• description</text>
                            <text x="20" y="180" class="entity-attr">• is_active</text>
                            <text x="20" y="200" class="entity-attr">Nota: unicidad por categoría</text>
                        </g>

                        <g data-node="Ticket" class="entity" transform="translate(840,420)">
                            <rect width="340" height="380"></rect>
                            <text x="170" y="32" text-anchor="middle" class="entity-header">Ticket</text>
                            <text x="20" y="70" class="entity-badges">UNIQUE · INDEX</text>
                            <text x="20" y="100" class="entity-attr">• id (PK)</text>
                            <text x="20" y="120" class="entity-attr">• code (UNIQUE)</text>
                            <text x="20" y="140" class="entity-attr">• title · description</text>
                            <text x="20" y="160" class="entity-attr">• kind {REQUEST|INCIDENT}</text>
                            <text x="20" y="180" class="entity-attr">• status {OPEN|IN_PROGRESS|RESOLVED|CLOSED}</text>
                            <text x="20" y="200" class="entity-attr">• requester_id (FK)</text>
                            <text x="20" y="220" class="entity-attr">• assigned_to_id (FK, NULL)</text>
                            <text x="20" y="240" class="entity-attr">• category_id (FK)</text>
                            <text x="20" y="260" class="entity-attr">• subcategory_id (FK, NULL)</text>
                            <text x="20" y="280" class="entity-attr">• priority_id (FK)</text>
                            <text x="20" y="300" class="entity-attr">• area_id (FK, NULL)</text>
                            <text x="20" y="320" class="entity-attr">• created_at (INDEX) · updated_at</text>
                            <text x="20" y="340" class="entity-attr">• resolved_at? · closed_at? · cluster_id (INDEX·DEPRECATED)</text>
                        </g>

                        <g data-node="Priority" class="entity" transform="translate(1240,120)">
                            <rect width="280" height="220"></rect>
                            <text x="140" y="32" text-anchor="middle" class="entity-header">Priority</text>
                            <text x="20" y="70" class="entity-badges">UNIQUE</text>
                            <text x="20" y="100" class="entity-attr">• id (PK)</text>
                            <text x="20" y="120" class="entity-attr">• name</text>
                            <text x="20" y="140" class="entity-attr">• sla_hours</text>
                        </g>

                        <g data-node="Area" class="entity" transform="translate(1240,420)">
                            <rect width="280" height="260"></rect>
                            <text x="140" y="32" text-anchor="middle" class="entity-header">Area</text>
                            <text x="20" y="70" class="entity-badges">UNIQUE</text>
                            <text x="20" y="100" class="entity-attr">• id (PK)</text>
                            <text x="20" y="120" class="entity-attr">• name</text>
                            <text x="20" y="140" class="entity-attr">• is_active</text>
                        </g>

                        <g data-node="TicketComment" class="entity" transform="translate(360,820)">
                            <rect width="300" height="240"></rect>
                            <text x="150" y="32" text-anchor="middle" class="entity-header">TicketComment</text>
                            <text x="20" y="70" class="entity-badges">FK</text>
                            <text x="20" y="100" class="entity-attr">• id (PK)</text>
                            <text x="20" y="120" class="entity-attr">• ticket_id (FK)</text>
                            <text x="20" y="140" class="entity-attr">• author_id (FK)</text>
                            <text x="20" y="160" class="entity-attr">• body</text>
                            <text x="20" y="180" class="entity-attr">• is_internal</text>
                            <text x="20" y="200" class="entity-attr">• created_at</text>
                        </g>

                        <g data-node="TicketAttachment" class="entity" transform="translate(720,820)">
                            <rect width="300" height="240"></rect>
                            <text x="150" y="32" text-anchor="middle" class="entity-header">TicketAttachment</text>
                            <text x="20" y="70" class="entity-badges">FK</text>
                            <text x="20" y="100" class="entity-attr">• id (PK)</text>
                            <text x="20" y="120" class="entity-attr">• ticket_id (FK)</text>
                            <text x="20" y="140" class="entity-attr">• uploaded_by_id (FK)</text>
                            <text x="20" y="160" class="entity-attr">• file</text>
                            <text x="20" y="180" class="entity-attr">• content_type · size</text>
                            <text x="20" y="200" class="entity-attr">• uploaded_at</text>
                        </g>

                        <g data-node="TicketAssignment" class="entity" transform="translate(1080,820)">
                            <rect width="320" height="240"></rect>
                            <text x="160" y="32" text-anchor="middle" class="entity-header">TicketAssignment</text>
                            <text x="20" y="70" class="entity-badges">FK</text>
                            <text x="20" y="100" class="entity-attr">• id (PK)</text>
                            <text x="20" y="120" class="entity-attr">• ticket_id (FK)</text>
                            <text x="20" y="140" class="entity-attr">• from_user_id (FK, NULL)</text>
                            <text x="20" y="160" class="entity-attr">• to_user_id (FK)</text>
                            <text x="20" y="180" class="entity-attr">• reason</text>
                            <text x="20" y="200" class="entity-attr">• created_at</text>
                        </g>

                        <g data-node="AuditLog" class="entity" transform="translate(1440,820)">
                            <rect width="320" height="260"></rect>
                            <text x="160" y="32" text-anchor="middle" class="entity-header">AuditLog</text>
                            <text x="20" y="70" class="entity-badges">FK</text>
                            <text x="20" y="100" class="entity-attr">• id (PK)</text>
                            <text x="20" y="120" class="entity-attr">• ticket_id (FK)</text>
                            <text x="20" y="140" class="entity-attr">• actor_id (FK, NULL)</text>
                            <text x="20" y="160" class="entity-attr">• action {CREATE|ASSIGN|UPDATE|STATUS|COMMENT|ATTACH|SLA_WARN|SLA_BREACH}</text>
                            <text x="20" y="180" class="entity-attr">• meta (JSON)</text>
                            <text x="20" y="200" class="entity-attr">• created_at</text>
                        </g>
                        <path class="relationship-line" data-edge="user-ticket" data-source="auth_user" data-target="Ticket" d="M400 220 H840"></path>
                        <text x="420" y="208" class="cardinality">1..N</text>
                        <text x="420" y="232" class="relationship-label">requester (CASCADE)</text>

                        <path class="relationship-line" data-edge="user-assigned" data-source="auth_user" data-target="Ticket" d="M400 260 H420 V520 H820"></path>
                        <text x="430" y="350" class="cardinality">1..N</text>
                        <text x="430" y="374" class="relationship-label">assigned_to (SET_NULL)</text>

                        <path class="relationship-line" data-edge="category-subcategory" data-source="Category" data-target="Subcategory" d="M760 200 H840"></path>
                        <text x="780" y="188" class="cardinality">1..N</text>
                        <text x="780" y="214" class="relationship-label">category (CASCADE)</text>

                        <path class="relationship-line" data-edge="category-ticket" data-source="Category" data-target="Ticket" d="M760 240 H820 V500 H840"></path>
                        <text x="790" y="320" class="cardinality">1..N</text>
                        <text x="790" y="344" class="relationship-label">category (PROTECT)</text>

                        <path class="relationship-line" data-edge="subcategory-ticket" data-source="Subcategory" data-target="Ticket" d="M1000 360 V420"></path>
                        <text x="1012" y="388" class="cardinality">1..N</text>
                        <text x="1020" y="410" class="relationship-label">subcategory (PROTECT, opcional)</text>

                        <path class="relationship-line" data-edge="priority-ticket" data-source="Priority" data-target="Ticket" d="M1240 220 H1210 V520 H1180"></path>
                        <text x="1218" y="420" class="cardinality">1..N</text>
                        <text x="1210" y="444" class="relationship-label">priority (PROTECT)</text>

                        <path class="relationship-line" data-edge="area-ticket" data-source="Area" data-target="Ticket" d="M1240 520 H1180"></path>
                        <text x="1210" y="508" class="cardinality">1..N</text>
                        <text x="1204" y="532" class="relationship-label">area (PROTECT, opcional)</text>

                        <path class="relationship-line" data-edge="ticket-comment" data-source="Ticket" data-target="TicketComment" d="M1010 800 V820"></path>
                        <text x="1020" y="812" class="cardinality">1..N</text>
                        <text x="1026" y="836" class="relationship-label">comentarios (CASCADE)</text>

                        <path class="relationship-line" data-edge="ticket-attachment" data-source="Ticket" data-target="TicketAttachment" d="M1070 800 V820"></path>
                        <text x="1080" y="812" class="cardinality">1..N</text>
                        <text x="1086" y="836" class="relationship-label">adjuntos (CASCADE)</text>

                        <path class="relationship-line" data-edge="ticket-assignment" data-source="Ticket" data-target="TicketAssignment" d="M1130 800 V820"></path>
                        <text x="1140" y="812" class="cardinality">1..N</text>
                        <text x="1146" y="836" class="relationship-label">asignaciones (CASCADE)</text>

                        <path class="relationship-line" data-edge="ticket-audit" data-source="Ticket" data-target="AuditLog" d="M1190 800 V820"></path>
                        <text x="1200" y="812" class="cardinality">1..N</text>
                        <text x="1206" y="836" class="relationship-label">auditoría (CASCADE)</text>

                        <path class="relationship-line" data-edge="user-comment" data-source="auth_user" data-target="TicketComment" d="M240 340 V780 H360 V820"></path>
                        <text x="220" y="600" class="cardinality">1..N</text>
                        <text x="226" y="624" class="relationship-label">author (CASCADE)</text>

                        <path class="relationship-line" data-edge="user-attachment" data-source="auth_user" data-target="TicketAttachment" d="M260 360 V780 H720 V820"></path>
                        <text x="300" y="760" class="cardinality">1..N</text>
                        <text x="306" y="784" class="relationship-label">uploaded_by (CASCADE)</text>

                        <path class="relationship-line" data-edge="user-assignment-from" data-source="auth_user" data-target="TicketAssignment" d="M400 360 H420 V780 H1080 V820"></path>
                        <text x="470" y="760" class="cardinality">1..N</text>
                        <text x="476" y="784" class="relationship-label">from_user (SET_NULL)</text>

                        <path class="relationship-line" data-edge="user-assignment-to" data-source="auth_user" data-target="TicketAssignment" d="M400 400 H440 V780 H1220 V820"></path>
                        <text x="520" y="760" class="cardinality">1..N</text>
                        <text x="526" y="784" class="relationship-label">to_user (CASCADE)</text>

                        <path class="relationship-line" data-edge="user-audit" data-source="auth_user" data-target="AuditLog" d="M400 440 H440 V780 H1440 V820"></path>
                        <text x="620" y="760" class="cardinality">1..N</text>
                        <text x="626" y="784" class="relationship-label">actor (SET_NULL)</text>

                        <text x="1120" y="1080" class="der-note">Ticket.code es único; created_at está indexado para reportes y ticket.cluster_id permanece por compatibilidad (deprecated).</text>
                    </svg>
                </div>
                <aside class="side-panel" data-side-panel>
                    <h3 id="der-node-title">auth_user</h3>
                    <div class="side-panel-content" id="der-panel-content"></div>
                </aside>
            </div>
        </section>
    </div>
    <script>
        const panels = document.getElementById('panels');
        const diagramButtons = document.querySelectorAll('.diagram-button');
        const closeButtons = document.querySelectorAll('[data-close]');
        const focusButtons = document.querySelectorAll('[data-focus]');

        let currentPanel = null;

        diagramButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetId = button.getAttribute('data-panel');
                const panel = document.getElementById(targetId);
                if (!panel) return;
                currentPanel = panel;
                panels.classList.add('visible');
                panel.classList.add('active');
            });
        });

        closeButtons.forEach(button => {
            button.addEventListener('click', () => {
                if (currentPanel) {
                    currentPanel.classList.remove('active', 'focus-mode');
                    currentPanel.querySelectorAll('[data-focus]').forEach(btn => btn.classList.remove('active'));
                    panels.classList.remove('visible');
                    currentPanel = null;
                }
            });
        });

        focusButtons.forEach(button => {
            button.addEventListener('click', () => {
                const panel = button.closest('.panel');
                panel.classList.toggle('focus-mode');
                button.classList.toggle('active');
                button.textContent = panel.classList.contains('focus-mode') ? 'Salir de foco' : 'Ampliar diagrama';
            });
        });

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && currentPanel) {
                currentPanel.classList.remove('active', 'focus-mode');
                currentPanel.querySelectorAll('[data-focus]').forEach(btn => btn.classList.remove('active'));
                panels.classList.remove('visible');
                currentPanel = null;
            }
        });

        function setupSidePanel(panelId, data) {
            const panel = document.getElementById(panelId);
            const sidePanel = panel.querySelector('[data-side-panel]');
            const titleEl = sidePanel.querySelector('h3');
            const contentEl = sidePanel.querySelector('.side-panel-content');
            let currentNode = Object.keys(data)[0];

            function render() {
                const nodeData = data[currentNode];
                titleEl.textContent = currentNode;
                contentEl.innerHTML = `<p>${nodeData.explanation}</p>`;
            }

            panel.querySelectorAll('[data-node]').forEach(node => {
                node.addEventListener('click', (event) => {
                    event.stopPropagation();
                    currentNode = node.getAttribute('data-node');
                    render();
                });
            });

            panel.addEventListener('nodeSelected', (evt) => {
                currentNode = evt.detail.name;
                render();
            });

            panel.addEventListener('nodeCleared', () => {
                currentNode = Object.keys(data)[0];
                render();
            });

            render();
            return { panel, data };
        }

        const deploymentData = {
            'Cliente': { explanation: 'Dispositivo del usuario final que accede por navegador protegido (HTTPS) y autentica contra el backend.' },
            'Internet': { explanation: 'Capa pública que enruta el tráfico HTTPS hacia la VPC privada.' },
            'IGW': { explanation: 'Internet Gateway pendiente de agregar para exponer la subred pública mediante la tabla de rutas.' },
            'Entrada VPC': { explanation: 'Security Group que autoriza el tráfico HTTPS entrante y lo entrega a la instancia EC2.' },
            'AWS VPC': { explanation: 'Red virtual de AWS que contiene subred pública para la aplicación y privada para la base de datos.' },
            'Subred pública': { explanation: 'Segmento accesible donde vive la instancia EC2 con Nginx, Gunicorn y Django.' },
            'Subred privada': { explanation: 'Segmento aislado sin exposición directa; aloja PostgreSQL con reglas estrictas.' },
            'NAT Gateway': { explanation: 'Servicio administrado pendiente para permitir salidas controladas desde la subred privada.' },
            'EC2 App': { explanation: 'Servidor EC2 que ejecuta la pila Nginx (terminación HTTPS), Gunicorn y la aplicación Django/DRF.' },
            'WAF/ALB': { explanation: 'WAF/ALB planificado para añadir protección de borde y balanceo antes de Nginx.' },
            '/media': { explanation: 'Directorio local para archivos adjuntos del sistema de tickets.' },
            'Logs': { explanation: 'Carpeta de registros de aplicación y servidor para auditoría operativa.' },
            'S3': { explanation: 'Bucket planificado para migrar adjuntos mediante django-storages.' },
            'PostgreSQL': { explanation: 'Base de datos PostgreSQL en subred privada; expone el puerto 5432 solo dentro de la VPC.' }
        };

        const usecaseData = {
            'Solicitante': { explanation: 'Usuario final que genera solicitudes, consulta el estado y comparte información del ticket.' },
            'Técnico': { explanation: 'Agente que resuelve tickets, ajusta estados, añade comentarios y analiza métricas operativas.' },
            'Administrador': { explanation: 'Perfil que supervisa la operación, administra catálogos y emite reportes y auditorías.' },
            'Iniciar/Cerrar sesión': { explanation: 'Flujo de autenticación y cierre de sesión para todos los perfiles.' },
            'Validar permisos por rol': { explanation: 'Control de autorización que condiciona las acciones según el rol del usuario.' },
            'FAQ autoservicio': { explanation: 'Consulta de respuestas rápidas para intentar resolver sin crear ticket.' },
            'Ver y filtrar tickets': { explanation: 'Visualización y filtrado por estado, prioridad o área de los tickets.' },
            'Crear ticket': { explanation: 'Registro de una nueva solicitud con categoría, prioridad y descripción.' },
            'Adjuntar y comentar': { explanation: 'Adjunta archivos y deja comentarios internos o públicos en el ticket.' },
            'Cambiar estado': { explanation: 'Transición del estado del ticket según la evolución del caso.' },
            'Asignar/Reasignar': { explanation: 'Entrega el ticket a otro técnico o equipo responsable.' },
            'Dashboard KPI': { explanation: 'Visualiza indicadores SLA, tiempos de atención y carga operativa.' },
            'Exportar PDF/Excel': { explanation: 'Genera reportes descargables en base a los filtros activos.' },
            'Gestionar catálogos': { explanation: 'Administra categorías, subcategorías, prioridades y áreas disponibles.' },
            'Auditoría': { explanation: 'Registra cada cambio relevante del ticket para trazabilidad completa.' }
        };

        const derData = {
            'auth_user': { explanation: 'Usuarios autenticados con flags de staff. Referenciados por tickets, comentarios, adjuntos, asignaciones y auditoría.' },
            'Category': { explanation: 'Clasificación principal del ticket. El nombre es único y se normaliza en MAYÚSCULAS.' },
            'Subcategory': { explanation: 'Detalle específico ligado a una categoría. Mantiene unicidad por categoría.' },
            'Ticket': { explanation: 'Entidad central del helpdesk con código único, campos indexados y múltiples referencias opcionales.' },
            'Priority': { explanation: 'Define niveles de urgencia con nombre único y horas de SLA.' },
            'Area': { explanation: 'Área o equipo responsable, con nombre único y flag de actividad.' },
            'TicketComment': { explanation: 'Historial de comentarios y notas internas asociados a un ticket.' },
            'TicketAttachment': { explanation: 'Archivos que acompañan un ticket, incluyen tipo de contenido y tamaño.' },
            'TicketAssignment': { explanation: 'Bitácora de asignaciones con origen, destino y motivo.' },
            'AuditLog': { explanation: 'Registro detallado de acciones sobre tickets, incluyendo metadatos y actor opcional.' }
        };

        setupSidePanel('deployment', deploymentData);
        setupSidePanel('usecases', usecaseData);
        setupSidePanel('der', derData);

        const toggleInputs = document.querySelectorAll('[data-toggle]');
        toggleInputs.forEach(input => {
            input.addEventListener('change', () => {
                const target = input.getAttribute('data-toggle');
                document.querySelectorAll(`[data-toggle-group="${target}"]`).forEach(group => {
                    group.classList.toggle('hidden', !input.checked);
                    if (input.checked) {
                        group.classList.add('active-planned');
                    } else {
                        group.classList.remove('active-planned');
                    }
                });
            });
        });

        function buildAdjacency(panel, adjacency) {
            const nodes = panel.querySelectorAll('[data-node]');
            const edges = panel.querySelectorAll('[data-source][data-target]');
            let selected = null;

            function clearHighlight() {
                nodes.forEach(n => n.classList.remove('active', 'dimmed'));
                edges.forEach(e => e.classList.remove('active', 'dimmed'));
            }

            function applyHighlight(name) {
                clearHighlight();
                if (!name) return;
                const neighbors = adjacency[name] || [];
                nodes.forEach(n => n.classList.add('dimmed'));
                edges.forEach(e => e.classList.add('dimmed'));
                panel.querySelectorAll(`[data-node="${name}"]`).forEach(n => {
                    n.classList.remove('dimmed');
                    n.classList.add('active');
                });
                neighbors.forEach(neighbor => {
                    panel.querySelectorAll(`[data-node="${neighbor}"]`).forEach(n => {
                        n.classList.remove('dimmed');
                        n.classList.add('active');
                    });
                    panel.querySelectorAll(`[data-source="${name}"][data-target="${neighbor}"]`).forEach(edge => {
                        edge.classList.remove('dimmed');
                        edge.classList.add('active');
                    });
                    panel.querySelectorAll(`[data-source="${neighbor}"][data-target="${name}"]`).forEach(edge => {
                        edge.classList.remove('dimmed');
                        edge.classList.add('active');
                    });
                });
            }

            panel.addEventListener('click', (event) => {
                if (!event.target.closest('[data-node]')) {
                    selected = null;
                    clearHighlight();
                    panel.dispatchEvent(new CustomEvent('nodeCleared'));
                }
            });

            nodes.forEach(node => {
                const nodeName = node.getAttribute('data-node');
                node.addEventListener('mouseenter', () => {
                    if (selected) return;
                    applyHighlight(nodeName);
                });
                node.addEventListener('mouseleave', () => {
                    if (selected) {
                        applyHighlight(selected);
                    } else {
                        clearHighlight();
                    }
                });
                node.addEventListener('click', () => {
                    if (selected === nodeName) {
                        selected = null;
                        clearHighlight();
                        panel.dispatchEvent(new CustomEvent('nodeCleared'));
                    } else {
                        selected = nodeName;
                        applyHighlight(nodeName);
                        panel.dispatchEvent(new CustomEvent('nodeSelected', { detail: { name: nodeName } }));
                    }
                });
            });
        }

        buildAdjacency(document.getElementById('deployment'), {
            'Cliente': ['Internet'],
            'Internet': ['Cliente', 'Entrada VPC', 'IGW', 'WAF/ALB'],
            'IGW': ['Entrada VPC', 'Internet'],
            'Entrada VPC': ['Internet', 'EC2 App', 'WAF/ALB'],
            'AWS VPC': ['Subred pública', 'Subred privada'],
            'Subred pública': ['EC2 App', 'AWS VPC', 'NAT Gateway'],
            'Subred privada': ['PostgreSQL', 'AWS VPC', 'NAT Gateway'],
            'NAT Gateway': ['Subred privada'],
            'EC2 App': ['Entrada VPC', 'PostgreSQL', '/media', 'Logs', 'S3'],
            'WAF/ALB': ['Internet', 'Entrada VPC', 'EC2 App'],
            '/media': ['EC2 App'],
            'Logs': ['EC2 App'],
            'S3': ['EC2 App'],
            'PostgreSQL': ['EC2 App', 'Subred privada']
        });

        buildAdjacency(document.getElementById('usecases'), {
            'Solicitante': ['Iniciar/Cerrar sesión', 'FAQ autoservicio', 'Ver y filtrar tickets', 'Crear ticket', 'Adjuntar y comentar'],
            'Técnico': ['Iniciar/Cerrar sesión', 'Ver y filtrar tickets', 'Adjuntar y comentar', 'Cambiar estado', 'Asignar/Reasignar', 'Dashboard KPI'],
            'Administrador': ['Iniciar/Cerrar sesión', 'Ver y filtrar tickets', 'Asignar/Reasignar', 'Dashboard KPI', 'Gestionar catálogos', 'Exportar PDF/Excel', 'Auditoría'],
            'Iniciar/Cerrar sesión': ['Solicitante', 'Técnico', 'Administrador', 'Validar permisos por rol'],
            'Validar permisos por rol': ['Iniciar/Cerrar sesión', 'Crear ticket', 'Adjuntar y comentar', 'Cambiar estado', 'Asignar/Reasignar', 'Dashboard KPI', 'Exportar PDF/Excel', 'Gestionar catálogos', 'Auditoría'],
            'FAQ autoservicio': ['Solicitante'],
            'Ver y filtrar tickets': ['Solicitante', 'Técnico', 'Administrador', 'Exportar PDF/Excel'],
            'Crear ticket': ['Solicitante', 'Validar permisos por rol', 'Auditoría'],
            'Adjuntar y comentar': ['Solicitante', 'Técnico', 'Validar permisos por rol', 'Auditoría'],
            'Cambiar estado': ['Técnico', 'Validar permisos por rol', 'Auditoría'],
            'Asignar/Reasignar': ['Técnico', 'Administrador', 'Validar permisos por rol', 'Auditoría'],
            'Dashboard KPI': ['Técnico', 'Administrador', 'Validar permisos por rol'],
            'Exportar PDF/Excel': ['Administrador', 'Ver y filtrar tickets', 'Validar permisos por rol'],
            'Gestionar catálogos': ['Administrador', 'Validar permisos por rol'],
            'Auditoría': ['Administrador', 'Crear ticket', 'Adjuntar y comentar', 'Cambiar estado', 'Asignar/Reasignar']
        });

        buildAdjacency(document.getElementById('der'), {
            'auth_user': ['Ticket', 'TicketComment', 'TicketAttachment', 'TicketAssignment', 'AuditLog'],
            'Category': ['Subcategory', 'Ticket'],
            'Subcategory': ['Category', 'Ticket'],
            'Ticket': ['auth_user', 'Category', 'Subcategory', 'Priority', 'Area', 'TicketComment', 'TicketAttachment', 'TicketAssignment', 'AuditLog'],
            'Priority': ['Ticket'],
            'Area': ['Ticket'],
            'TicketComment': ['Ticket', 'auth_user'],
            'TicketAttachment': ['Ticket', 'auth_user'],
            'TicketAssignment': ['Ticket', 'auth_user'],
            'AuditLog': ['Ticket', 'auth_user']
        });

        const actorFilters = document.querySelectorAll('[data-actor-filter]');
        actorFilters.forEach(btn => {
            btn.addEventListener('click', () => {
                const filter = btn.getAttribute('data-actor-filter');
                actorFilters.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const panel = document.getElementById('usecases');
                const actors = panel.querySelectorAll('.actor');
                const usecases = panel.querySelectorAll('.usecase');
                const labels = panel.querySelectorAll('.usecase-label');
                const connectors = panel.querySelectorAll('.actor-connector');
                const relationLines = panel.querySelectorAll('.relation-line');

                if (filter === 'todos') {
                    actors.forEach(a => a.classList.remove('dimmed'));
                    usecases.forEach(u => u.classList.remove('dimmed', 'usecase-faded'));
                    labels.forEach(l => l.classList.remove('dimmed', 'usecase-faded'));
                    connectors.forEach(c => c.classList.remove('dimmed', 'active', 'usecase-faded'));
                    relationLines.forEach(r => r.classList.remove('dimmed', 'active', 'usecase-faded'));
                    return;
                }

                actors.forEach(actor => {
                    const name = actor.getAttribute('data-node');
                    const isActive = name.toLowerCase() === filter;
                    actor.classList.toggle('dimmed', !isActive);
                    actor.classList.toggle('active', isActive);
                });

                usecases.forEach(u => {
                    u.classList.add('usecase-faded');
                    u.classList.remove('dimmed');
                });
                labels.forEach(l => {
                    l.classList.add('usecase-faded');
                    l.classList.remove('dimmed');
                });
                connectors.forEach(c => {
                    c.classList.add('usecase-faded');
                    c.classList.remove('dimmed', 'active');
                });
                relationLines.forEach(r => {
                    r.classList.add('usecase-faded');
                    r.classList.remove('dimmed', 'active');
                });

                const activeActor = Array.from(actors).find(actor => actor.getAttribute('data-node').toLowerCase() === filter);
                const activeName = activeActor ? activeActor.getAttribute('data-node') : null;

                connectors.forEach(connector => {
                    if (connector.getAttribute('data-source') === activeName) {
                        connector.classList.remove('usecase-faded');
                        connector.classList.add('active');
                        const target = connector.getAttribute('data-target');
                        document.querySelectorAll(`[data-node="${target}"] .usecase`).forEach(el => el.classList.remove('usecase-faded'));
                        document.querySelectorAll(`[data-usecase="${target}"]`).forEach(el => el.classList.remove('usecase-faded'));
                    }
                });

                relationLines.forEach(line => {
                    const source = line.getAttribute('data-source');
                    const target = line.getAttribute('data-target');
                    if (source && document.querySelector(`[data-node="${source}"] .usecase:not(.usecase-faded)`)) {
                        line.classList.remove('usecase-faded');
                        line.classList.add('active');
                        document.querySelectorAll(`[data-node="${target}"] .usecase`).forEach(el => el.classList.remove('usecase-faded'));
                        document.querySelectorAll(`[data-usecase="${target}"]`).forEach(el => el.classList.remove('usecase-faded'));
                    }
                });
            });
        });
    </script>
</body>
</html>
