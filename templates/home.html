<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coyahue Helpdesk</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            color-scheme: dark;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle at top left, rgba(110, 11, 212, 0.6), transparent 40%),
                        radial-gradient(circle at bottom right, rgba(0, 245, 212, 0.55), transparent 45%),
                        linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .aurora {
            position: fixed;
            inset: -35vh -35vw;
            background: conic-gradient(from 90deg, rgba(255, 0, 122, 0.35), rgba(0, 255, 242, 0.45), rgba(255, 255, 0, 0.35), rgba(255, 0, 122, 0.35));
            filter: blur(130px);
            animation: rotate 24s linear infinite;
            z-index: 0;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .container {
            position: relative;
            z-index: 1;
            text-align: center;
            padding: 4.5rem 4rem;
            border-radius: 38px;
            background: rgba(15, 23, 42, 0.78);
            border: 1px solid rgba(148, 163, 184, 0.35);
            backdrop-filter: blur(18px);
            box-shadow: 0 40px 90px rgba(15, 23, 42, 0.55);
            max-width: 720px;
            width: min(92vw, 720px);
        }

        h1 {
            font-size: clamp(2.8rem, 4.5vw + 1rem, 4.4rem);
            margin-bottom: 3rem;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            text-shadow: 0 8px 32px rgba(59, 130, 246, 0.35);
        }

        .buttons {
            display: grid;
            gap: 1.2rem;
            grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
        }

        .diagram-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 1.1rem 1.5rem;
            border-radius: 16px;
            font-weight: 600;
            letter-spacing: 0.06em;
            text-decoration: none;
            color: #0f172a;
            background: linear-gradient(135deg, #facc15, #f472b6);
            box-shadow: 0 18px 45px rgba(250, 204, 21, 0.45);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .diagram-button::before {
            content: "";
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.35);
            clip-path: polygon(0 0, 100% 0, 75% 100%, 0% 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .diagram-button:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 28px 55px rgba(244, 114, 182, 0.6);
        }

        .diagram-button:hover::before {
            opacity: 0.45;
        }

        .panels {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            background: rgba(8, 15, 35, 0.82);
            backdrop-filter: blur(16px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.45s ease;
            z-index: 5;
        }

        .panels.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .panel {
            width: min(1200px, 94vw);
            height: min(880px, 92vh);
            border-radius: 30px;
            border: 1px solid rgba(148, 163, 184, 0.35);
            background: linear-gradient(160deg, rgba(15, 23, 42, 0.94), rgba(17, 24, 39, 0.88));
            box-shadow: 0 45px 100px rgba(15, 23, 42, 0.65);
            transform: translateY(40px) scale(0.96);
            opacity: 0;
            transition: transform 0.5s cubic-bezier(.16,.84,.44,1), opacity 0.5s ease;
            display: none;
            overflow: hidden;
        }

        .panel.active {
            display: flex;
            flex-direction: column;
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.6rem 2.4rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.25);
            flex-shrink: 0;
        }

        .panel-header h2 {
            margin: 0;
            font-size: 1.9rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .back-button {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(148, 163, 184, 0.5);
            color: rgba(226, 232, 240, 0.92);
            padding: 0.65rem 1.6rem;
            border-radius: 999px;
            cursor: pointer;
            font-weight: 500;
            letter-spacing: 0.08em;
            transition: background 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
        }

        .back-button:hover {
            background: rgba(59, 130, 246, 0.25);
            color: #fff;
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.35);
        }

        .panel-body {
            flex: 1;
            padding: 2.4rem;
            overflow: auto;
        }

        .panel-body::-webkit-scrollbar {
            width: 8px;
        }

        .panel-body::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, 0.4);
            border-radius: 999px;
        }

        .diagram-wrapper {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .diagram-wrapper svg {
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.45);
            border: 1px solid rgba(96, 165, 250, 0.28);
            border-radius: 24px;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem 1.4rem;
            padding: 1.2rem 1.4rem;
            border-radius: 18px;
            background: rgba(30, 41, 59, 0.55);
            border: 1px solid rgba(96, 165, 250, 0.32);
            font-size: 0.9rem;
        }

        .legend span {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
        }

        .legend span::before {
            content: "";
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 999px;
        }

        .legend .public::before { background: #38bdf8; }
        .legend .private::before { background: #22d3ee; }
        .legend .security::before { background: #f97316; }
        .legend .data::before { background: #34d399; }

        .deployment-node {
            fill: rgba(12, 74, 110, 0.32);
            stroke: rgba(125, 211, 252, 0.55);
            stroke-width: 2.4;
        }

        .deployment-subnet {
            fill: rgba(14, 116, 144, 0.18);
            stroke: rgba(125, 211, 252, 0.45);
            stroke-width: 2;
            stroke-dasharray: 12 10;
        }

        .deployment-text {
            fill: rgba(226, 232, 240, 0.95);
            font-size: 16px;
            font-weight: 500;
        }

        .deployment-detail {
            fill: rgba(148, 163, 184, 0.9);
            font-size: 13px;
        }

        .link {
            stroke: rgba(96, 165, 250, 0.75);
            stroke-width: 2.6;
            fill: none;
            stroke-linecap: round;
            stroke-dasharray: 6 10;
            opacity: 0.2;
            animation: flow 5s linear infinite;
        }

        .link.emphasized {
            opacity: 0.9;
            stroke-dasharray: 14 8;
            animation: pulse 2.4s ease-in-out infinite;
        }

        @keyframes flow {
            from { stroke-dashoffset: 0; }
            to { stroke-dashoffset: -200; }
        }

        @keyframes pulse {
            0%, 100% { stroke-dashoffset: 0; opacity: 0.4; }
            50% { stroke-dashoffset: -40; opacity: 0.95; }
        }

        .usecase-layout {
            display: grid;
            grid-template-columns: minmax(520px, 1fr) minmax(280px, 360px);
            gap: 2rem;
            height: 100%;
        }

        .usecase-diagram {
            position: relative;
            border-radius: 24px;
            border: 1px solid rgba(129, 140, 248, 0.35);
            background: rgba(30, 27, 75, 0.55);
            padding: 1.4rem;
        }

        #usecase-svg {
            width: 100%;
            height: 100%;
        }

        .actor {
            cursor: pointer;
            transition: transform 0.4s ease, filter 0.4s ease;
        }

        .actor:hover {
            transform: translateY(-6px);
            filter: drop-shadow(0 10px 20px rgba(192, 132, 252, 0.45));
        }

        .actor.active {
            filter: drop-shadow(0 0 18px rgba(192, 132, 252, 0.75));
        }

        .usecase {
            fill: rgba(59, 130, 246, 0.18);
            stroke: rgba(96, 165, 250, 0.8);
            stroke-width: 2.2;
            transition: transform 0.35s ease, fill 0.35s ease, stroke 0.35s ease, opacity 0.35s ease;
            opacity: 0.35;
        }

        .usecase-label {
            fill: rgba(226, 232, 240, 0.85);
            font-size: 14px;
            pointer-events: none;
            opacity: 0.35;
            transition: opacity 0.35s ease;
        }

        .connector {
            stroke: rgba(226, 232, 240, 0.4);
            stroke-width: 2.4;
            fill: none;
            stroke-dasharray: 8 14;
            stroke-linecap: round;
            opacity: 0;
            transition: opacity 0.45s ease;
        }

        .connector.active {
            opacity: 1;
            animation: draw 1.1s ease forwards;
        }

        @keyframes draw {
            from { stroke-dashoffset: 160; }
            to { stroke-dashoffset: 0; }
        }

        .usecase.active {
            fill: rgba(59, 130, 246, 0.35);
            stroke: rgba(125, 211, 252, 0.95);
            transform: scale(1.03);
            opacity: 1;
        }

        .usecase-label.active {
            opacity: 1;
        }

        .include-arrow, .extend-arrow {
            stroke-width: 2;
            fill: none;
        }

        .include-arrow {
            stroke: rgba(250, 204, 21, 0.85);
            stroke-dasharray: 4 6;
            marker-end: url(#include-arrow);
        }

        .extend-arrow {
            stroke: rgba(248, 113, 113, 0.85);
            stroke-dasharray: 3 9;
            marker-end: url(#extend-arrow);
        }

        .relation-label {
            fill: rgba(250, 204, 21, 0.9);
            font-size: 12px;
        }

        .extend-label {
            fill: rgba(248, 113, 113, 0.9);
        }

        .usecase-info {
            border-radius: 24px;
            border: 1px solid rgba(99, 102, 241, 0.45);
            background: rgba(30, 41, 59, 0.55);
            padding: 1.8rem;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }

        .usecase-info h3 {
            margin: 0;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: #c4b5fd;
        }

        .usecase-info h4 {
            margin-bottom: 0.35rem;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            color: rgba(165, 180, 252, 0.95);
            font-size: 0.95rem;
        }

        .usecase-info ul {
            margin: 0;
            padding-left: 1.2rem;
            color: rgba(226, 232, 240, 0.85);
            line-height: 1.6;
        }

        .info-note {
            font-size: 0.9rem;
            color: rgba(226, 232, 240, 0.6);
        }

        .reset-selection {
            align-self: flex-start;
            background: rgba(76, 29, 149, 0.55);
            border: 1px solid rgba(129, 140, 248, 0.5);
            color: #ede9fe;
            padding: 0.5rem 1.3rem;
            border-radius: 999px;
            cursor: pointer;
            letter-spacing: 0.05em;
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }

        .reset-selection:hover {
            background: rgba(99, 102, 241, 0.75);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.35);
        }

        .der-wrapper {
            display: grid;
            gap: 1.5rem;
            height: 100%;
        }

        #der-svg {
            width: 100%;
            height: 100%;
        }

        .entity {
            fill: rgba(15, 118, 110, 0.18);
            stroke: rgba(45, 212, 191, 0.7);
            stroke-width: 2.2;
            rx: 20;
            ry: 20;
        }

        .entity-header {
            fill: rgba(16, 185, 129, 0.92);
            font-size: 16px;
            font-weight: 600;
        }

        .entity-attr {
            fill: rgba(209, 250, 229, 0.88);
            font-size: 13px;
        }

        .relationship-line {
            stroke: rgba(16, 185, 129, 0.75);
            stroke-width: 2.4;
            fill: none;
            marker-end: url(#der-arrow);
        }

        .cardinality {
            fill: rgba(167, 243, 208, 0.85);
            font-size: 12px;
        }

        .relationship-label {
            fill: rgba(110, 231, 183, 0.9);
            font-size: 12px;
        }

        .der-note {
            border-radius: 20px;
            border: 1px solid rgba(45, 212, 191, 0.4);
            background: rgba(6, 78, 59, 0.4);
            padding: 1.4rem 1.6rem;
            color: rgba(209, 250, 229, 0.88);
            line-height: 1.6;
        }

        @media (max-width: 1024px) {
            .panel {
                width: min(960px, 96vw);
            }

            .usecase-layout {
                grid-template-columns: 1fr;
                grid-auto-rows: auto;
            }

            .usecase-info {
                order: -1;
            }
        }

        @media (max-width: 640px) {
            .container {
                padding: 3.2rem 2.4rem;
            }

            .panel-body {
                padding: 1.6rem;
            }

            .panel-header {
                padding: 1.2rem 1.6rem;
            }
        }
    </style>
</head>
<body>
    <div class="aurora"></div>
    <div class="container">
        <h1>Coyahue Helpdesk</h1>
        <div class="buttons">
            <button class="diagram-button" data-panel="deployment">Vista de Despliegue</button>
            <button class="diagram-button" data-panel="usecases">Casos de Uso</button>
            <button class="diagram-button" data-panel="der">DER</button>
        </div>
    </div>

    <div class="panels" id="panels">
        <div class="panel" id="deployment">
            <div class="panel-header">
                <h2>Arquitectura de Despliegue (Físico)</h2>
                <button class="back-button" data-close>Volver</button>
            </div>
            <div class="panel-body">
                <div class="diagram-wrapper">
                    <svg id="deployment-svg" viewBox="0 0 1200 720" aria-labelledby="deploymentTitle deploymentDesc" role="img">
                        <title id="deploymentTitle">Diagrama de despliegue de Coyahue Helpdesk</title>
                        <desc id="deploymentDesc">Componentes físicos, subredes y flujos de red.</desc>
                        <defs>
                            <marker id="arrow-head" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto" markerUnits="strokeWidth">
                                <polygon points="0 0, 10 5, 0 10" fill="rgba(96, 165, 250, 0.9)"></polygon>
                            </marker>
                        </defs>

                        <rect x="60" y="260" width="170" height="170" rx="18" class="deployment-node"></rect>
                        <text x="145" y="302" text-anchor="middle" class="deployment-text">Cliente</text>
                        <text x="145" y="332" text-anchor="middle" class="deployment-detail">Navegador web</text>
                        <text x="145" y="352" text-anchor="middle" class="deployment-detail">HTTPS :443</text>

                        <circle cx="320" cy="345" r="70" fill="rgba(30, 64, 175, 0.28)" stroke="rgba(96, 165, 250, 0.55)" stroke-width="2.2"></circle>
                        <text x="320" y="325" text-anchor="middle" class="deployment-text">Internet</text>
                        <text x="320" y="353" text-anchor="middle" class="deployment-detail">Gateway público</text>
                        <text x="320" y="373" text-anchor="middle" class="deployment-detail">Rutas seguras</text>

                        <rect x="420" y="100" width="720" height="520" rx="26" fill="rgba(15, 118, 110, 0.12)" stroke="rgba(45, 212, 191, 0.5)" stroke-width="2.4"></rect>
                        <text x="1080" y="130" text-anchor="end" class="deployment-text">AWS VPC privada</text>
                        <text x="1080" y="154" text-anchor="end" class="deployment-detail">CIDR 10.0.0.0/16 · SG segmentados</text>

                        <rect x="455" y="150" width="330" height="430" rx="22" class="deployment-subnet"></rect>
                        <text x="620" y="188" text-anchor="middle" class="deployment-text">Subred Pública</text>
                        <text x="620" y="210" text-anchor="middle" class="deployment-detail">10.0.1.0/24</text>

                        <rect x="820" y="150" width="280" height="430" rx="22" class="deployment-subnet"></rect>
                        <text x="960" y="188" text-anchor="middle" class="deployment-text">Subred Privada</text>
                        <text x="960" y="210" text-anchor="middle" class="deployment-detail">10.0.2.0/24</text>

                        <rect x="500" y="250" width="240" height="120" rx="18" class="deployment-node"></rect>
                        <text x="620" y="280" text-anchor="middle" class="deployment-text">EC2 App + Nginx</text>
                        <text x="620" y="306" text-anchor="middle" class="deployment-detail">Terminación TLS</text>
                        <text x="620" y="326" text-anchor="middle" class="deployment-detail">Gunicorn / Django</text>

                        <rect x="500" y="420" width="240" height="120" rx="18" class="deployment-node"></rect>
                        <text x="620" y="450" text-anchor="middle" class="deployment-text">Servicios de Aplicación</text>
                        <text x="620" y="476" text-anchor="middle" class="deployment-detail">Django REST Framework</text>
                        <text x="620" y="496" text-anchor="middle" class="deployment-detail">Logs + /media local</text>

                        <rect x="860" y="250" width="200" height="120" rx="18" class="deployment-node"></rect>
                        <text x="960" y="280" text-anchor="middle" class="deployment-text">PostgreSQL</text>
                        <text x="960" y="306" text-anchor="middle" class="deployment-detail">Puerto 5432</text>
                        <text x="960" y="326" text-anchor="middle" class="deployment-detail">Security Group DB</text>

                        <rect x="860" y="420" width="200" height="120" rx="18" class="deployment-node"></rect>
                        <text x="960" y="450" text-anchor="middle" class="deployment-text">Servicios Opcionales</text>
                        <text x="960" y="476" text-anchor="middle" class="deployment-detail">NAT · S3</text>
                        <text x="960" y="496" text-anchor="middle" class="deployment-detail">CloudWatch Logs</text>

                        <line x1="230" y1="345" x2="250" y2="345" class="link emphasized" marker-end="url(#arrow-head)"></line>
                        <line x1="390" y1="345" x2="455" y2="320" class="link emphasized" marker-end="url(#arrow-head)"></line>
                        <line x1="620" y1="370" x2="620" y2="420" class="link emphasized" marker-end="url(#arrow-head)"></line>
                        <line x1="740" y1="460" x2="860" y2="460" class="link emphasized" marker-end="url(#arrow-head)"></line>
                        <line x1="740" y1="310" x2="860" y2="310" class="link emphasized" marker-end="url(#arrow-head)"></line>
                        <line x1="960" y1="370" x2="960" y2="420" class="link"></line>
                    </svg>
                    <div class="legend">
                        <span class="public">Subred pública · EC2 App · Nginx/Gunicorn</span>
                        <span class="private">Subred privada · PostgreSQL · NAT</span>
                        <span class="security">Security Groups · TLS en borde · Auditoría</span>
                        <span class="data">Almacenamiento /media · Logs · Métricas</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel" id="usecases">
            <div class="panel-header">
                <h2>Casos de Uso del Sistema</h2>
                <button class="back-button" data-close>Volver</button>
            </div>
            <div class="panel-body">
                <div class="usecase-layout">
                    <div class="usecase-diagram">
                        <svg id="usecase-svg" viewBox="0 0 960 640" aria-labelledby="usecaseTitle usecaseDesc" role="img">
                            <title id="usecaseTitle">Diagrama de casos de uso</title>
                            <desc id="usecaseDesc">Actores solicitante, técnico y administrador con relaciones include/extend.</desc>
                            <defs>
                                <marker id="include-arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto" markerUnits="strokeWidth">
                                    <polygon points="0 0, 8 4, 0 8" fill="rgba(250, 204, 21, 0.85)"></polygon>
                                </marker>
                                <marker id="extend-arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto" markerUnits="strokeWidth">
                                    <polygon points="0 0, 8 4, 0 8" fill="rgba(248, 113, 113, 0.85)"></polygon>
                                </marker>
                            </defs>

                            <rect x="280" y="70" width="420" height="500" rx="26" fill="rgba(30, 64, 175, 0.22)" stroke="rgba(129, 140, 248, 0.7)" stroke-width="2.4"></rect>
                            <text x="490" y="100" text-anchor="middle" fill="rgba(226, 232, 240, 0.85)" font-size="16" letter-spacing="2">Coyahue Helpdesk</text>

                            <g id="actor-solicitante" class="actor" data-actor="solicitante">
                                <circle cx="120" cy="180" r="26" fill="none" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></circle>
                                <line x1="120" y1="206" x2="120" y2="280" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                <line x1="90" y1="230" x2="150" y2="230" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                <line x1="120" y1="280" x2="95" y2="330" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                <line x1="120" y1="280" x2="145" y2="330" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                <text x="120" y="360" text-anchor="middle" fill="rgba(196, 181, 253, 0.9)" font-size="16">Solicitante</text>
                            </g>

                            <g id="actor-tecnico" class="actor" data-actor="tecnico">
                                <circle cx="120" cy="420" r="26" fill="none" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></circle>
                                <line x1="120" y1="446" x2="120" y2="520" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                <line x1="90" y1="470" x2="150" y2="470" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                <line x1="120" y1="520" x2="95" y2="570" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                <line x1="120" y1="520" x2="145" y2="570" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                <text x="120" y="600" text-anchor="middle" fill="rgba(196, 181, 253, 0.9)" font-size="16">Técnico</text>
                            </g>

                            <g id="actor-administrador" class="actor" data-actor="administrador">
                                <circle cx="840" cy="320" r="26" fill="none" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></circle>
                                <line x1="840" y1="346" x2="840" y2="420" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                <line x1="810" y1="370" x2="870" y2="370" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                <line x1="840" y1="420" x2="815" y2="470" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                <line x1="840" y1="420" x2="865" y2="470" stroke="rgba(196, 181, 253, 0.9)" stroke-width="3"></line>
                                <text x="840" y="500" text-anchor="middle" fill="rgba(196, 181, 253, 0.9)" font-size="16">Administrador</text>
                            </g>

                            <ellipse id="usecase-login" class="usecase" cx="490" cy="170" rx="110" ry="40"></ellipse>
                            <text class="usecase-label" data-usecase="usecase-login" x="490" y="176" text-anchor="middle">Iniciar / Cerrar sesión</text>

                            <ellipse id="usecase-faq" class="usecase" cx="420" cy="260" rx="105" ry="38"></ellipse>
                            <text class="usecase-label" data-usecase="usecase-faq" x="420" y="266" text-anchor="middle">FAQ autoservicio</text>

                            <ellipse id="usecase-ver" class="usecase" cx="560" cy="260" rx="115" ry="38"></ellipse>
                            <text class="usecase-label" data-usecase="usecase-ver" x="560" y="266" text-anchor="middle">Ver y filtrar tickets</text>

                            <ellipse id="usecase-crear" class="usecase" cx="430" cy="350" rx="115" ry="40"></ellipse>
                            <text class="usecase-label" data-usecase="usecase-crear" x="430" y="356" text-anchor="middle">Crear ticket</text>

                            <ellipse id="usecase-adjuntar" class="usecase" cx="560" cy="350" rx="120" ry="40"></ellipse>
                            <text class="usecase-label" data-usecase="usecase-adjuntar" x="560" y="356" text-anchor="middle">Adjuntar y comentar</text>

                            <ellipse id="usecase-estado" class="usecase" cx="430" cy="440" rx="115" ry="40"></ellipse>
                            <text class="usecase-label" data-usecase="usecase-estado" x="430" y="446" text-anchor="middle">Cambiar estado</text>

                            <ellipse id="usecase-asignar" class="usecase" cx="560" cy="440" rx="120" ry="40"></ellipse>
                            <text class="usecase-label" data-usecase="usecase-asignar" x="560" y="446" text-anchor="middle">Asignar / Reasignar</text>

                            <ellipse id="usecase-dashboard" class="usecase" cx="490" cy="520" rx="120" ry="40"></ellipse>
                            <text class="usecase-label" data-usecase="usecase-dashboard" x="490" y="526" text-anchor="middle">Dashboard KPI</text>

                            <ellipse id="usecase-catalogos" class="usecase" cx="650" cy="330" rx="120" ry="40"></ellipse>
                            <text class="usecase-label" data-usecase="usecase-catalogos" x="650" y="336" text-anchor="middle">Gestionar catálogos</text>

                            <ellipse id="usecase-exportar" class="usecase" cx="650" cy="420" rx="120" ry="40"></ellipse>
                            <text class="usecase-label" data-usecase="usecase-exportar" x="650" y="426" text-anchor="middle">Exportar PDF / Excel</text>

                            <ellipse id="usecase-auditoria" class="usecase" cx="650" cy="520" rx="120" ry="40"></ellipse>
                            <text class="usecase-label" data-usecase="usecase-auditoria" x="650" y="526" text-anchor="middle">Auditoría</text>

                            <ellipse id="usecase-permisos" class="usecase" cx="490" cy="600" rx="120" ry="40"></ellipse>
                            <text class="usecase-label" data-usecase="usecase-permisos" x="490" y="606" text-anchor="middle">Validar permisos por rol</text>

                            <path id="conn-solicitante-login" class="connector" d="M180 230 C260 210, 340 190, 380 180"></path>
                            <path id="conn-solicitante-faq" class="connector" d="M170 250 C260 240, 320 240, 360 250"></path>
                            <path id="conn-solicitante-ver" class="connector" d="M180 270 C260 270, 360 280, 460 270"></path>
                            <path id="conn-solicitante-crear" class="connector" d="M180 290 C260 320, 320 340, 330 350"></path>
                            <path id="conn-solicitante-adjuntar" class="connector" d="M180 300 C300 350, 420 360, 440 360"></path>

                            <path id="conn-tecnico-login" class="connector" d="M180 470 C260 450, 340 210, 420 200"></path>
                            <path id="conn-tecnico-ver" class="connector" d="M180 470 C260 430, 420 340, 460 320"></path>
                            <path id="conn-tecnico-adjuntar" class="connector" d="M180 490 C260 450, 380 390, 420 380"></path>
                            <path id="conn-tecnico-estado" class="connector" d="M180 500 C260 480, 320 460, 330 450"></path>
                            <path id="conn-tecnico-asignar" class="connector" d="M180 520 C320 520, 400 460, 440 450"></path>
                            <path id="conn-tecnico-dashboard" class="connector" d="M180 530 C320 580, 420 560, 460 550"></path>

                            <path id="conn-admin-login" class="connector" d="M780 320 C700 230, 620 200, 560 190"></path>
                            <path id="conn-admin-ver" class="connector" d="M780 330 C700 300, 640 280, 620 270"></path>
                            <path id="conn-admin-asignar" class="connector" d="M780 340 C700 360, 640 400, 620 420"></path>
                            <path id="conn-admin-dashboard" class="connector" d="M780 360 C700 420, 600 520, 560 530"></path>
                            <path id="conn-admin-catalogos" class="connector" d="M780 340 C740 340, 720 330, 700 330"></path>
                            <path id="conn-admin-exportar" class="connector" d="M780 360 C740 380, 720 400, 700 410"></path>
                            <path id="conn-admin-auditoria" class="connector" d="M780 380 C740 440, 720 500, 700 510"></path>

                            <path class="include-arrow" d="M430 390 L430 425" marker-end="url(#include-arrow)"></path>
                            <text class="relation-label" x="446" y="405">«include»</text>

                            <path class="include-arrow" d="M560 390 L560 425" marker-end="url(#include-arrow)"></path>
                            <text class="relation-label" x="576" y="405">«include»</text>

                            <path class="include-arrow" d="M650 460 L650 500" marker-end="url(#include-arrow)"></path>
                            <text class="relation-label" x="666" y="475">«include»</text>

                            <path class="include-arrow" d="M490 560 L490 585" marker-end="url(#include-arrow)"></path>
                            <text class="relation-label" x="506" y="570">«include»</text>

                            <path class="include-arrow" d="M650 365 L650 400" marker-end="url(#include-arrow)"></path>
                            <text class="relation-label" x="666" y="380">«include»</text>

                            <path class="include-arrow" d="M560 300 L560 340" marker-end="url(#include-arrow)"></path>
                            <text class="relation-label" x="576" y="315">«include»</text>

                            <path class="extend-arrow" d="M420 222 L420 240" marker-end="url(#extend-arrow)"></path>
                            <text class="relation-label extend-label" x="436" y="232">«extend»</text>
                        </svg>
                        <p class="info-note">Pulsa un actor del diagrama para animar sus casos de uso y relaciones.</p>
                    </div>
                    <div class="usecase-info" id="usecase-info">
                        <h3>Selecciona un actor</h3>
                        <p class="info-note">El detalle de casos, relaciones y reglas aparecerá aquí al activar un actor.</p>
                        <button class="reset-selection" id="reset-actors" type="button">Limpiar selección</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel" id="der">
            <div class="panel-header">
                <h2>Diagrama Entidad-Relación</h2>
                <button class="back-button" data-close>Volver</button>
            </div>
            <div class="panel-body">
                <div class="der-wrapper">
                    <svg id="der-svg" viewBox="0 0 1200 760" aria-labelledby="derTitle derDesc" role="img">
                        <title id="derTitle">DER Coyahue Helpdesk</title>
                        <desc id="derDesc">Entidades principales con cardinalidades clave.</desc>
                        <defs>
                            <marker id="der-arrow" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto" markerUnits="strokeWidth">
                                <polygon points="0 0, 10 5, 0 10" fill="rgba(16, 185, 129, 0.9)"></polygon>
                            </marker>
                        </defs>

                        <rect x="120" y="80" width="220" height="160" class="entity"></rect>
                        <text x="230" y="120" text-anchor="middle" class="entity-header">auth_user</text>
                        <text x="140" y="150" class="entity-attr">• id (PK)</text>
                        <text x="140" y="170" class="entity-attr">• username, email, password</text>
                        <text x="140" y="190" class="entity-attr">• is_active, is_staff, is_superuser</text>
                        <text x="140" y="210" class="entity-attr">• date_joined, last_login</text>

                        <rect x="420" y="80" width="220" height="160" class="entity"></rect>
                        <text x="530" y="120" text-anchor="middle" class="entity-header">Category</text>
                        <text x="440" y="150" class="entity-attr">• id (PK)</text>
                        <text x="440" y="170" class="entity-attr">• name (UNIQUE)</text>
                        <text x="440" y="190" class="entity-attr">• description</text>
                        <text x="440" y="210" class="entity-attr">• is_active</text>

                        <rect x="720" y="80" width="220" height="180" class="entity"></rect>
                        <text x="830" y="120" text-anchor="middle" class="entity-header">Subcategory</text>
                        <text x="740" y="150" class="entity-attr">• id (PK)</text>
                        <text x="740" y="170" class="entity-attr">• category_id (FK)</text>
                        <text x="740" y="190" class="entity-attr">• name</text>
                        <text x="740" y="210" class="entity-attr">• description</text>
                        <text x="740" y="230" class="entity-attr">• is_active</text>

                        <rect x="1020" y="80" width="220" height="180" class="entity"></rect>
                        <text x="1130" y="120" text-anchor="middle" class="entity-header">Priority</text>
                        <text x="1040" y="150" class="entity-attr">• id (PK)</text>
                        <text x="1040" y="170" class="entity-attr">• name</text>
                        <text x="1040" y="190" class="entity-attr">• sla_hours</text>
                        <text x="1040" y="210" class="entity-attr">• color</text>

                        <rect x="120" y="300" width="220" height="200" class="entity"></rect>
                        <text x="230" y="340" text-anchor="middle" class="entity-header">Area</text>
                        <text x="140" y="370" class="entity-attr">• id (PK)</text>
                        <text x="140" y="390" class="entity-attr">• name</text>
                        <text x="140" y="410" class="entity-attr">• description</text>
                        <text x="140" y="430" class="entity-attr">• is_active</text>

                        <rect x="420" y="300" width="280" height="240" class="entity"></rect>
                        <text x="560" y="340" text-anchor="middle" class="entity-header">Ticket</text>
                        <text x="440" y="370" class="entity-attr">• id (PK)</text>
                        <text x="440" y="390" class="entity-attr">• title, description</text>
                        <text x="440" y="410" class="entity-attr">• category_id, subcategory_id</text>
                        <text x="440" y="430" class="entity-attr">• priority_id, area_id</text>
                        <text x="440" y="450" class="entity-attr">• requester_id, assigned_to_id</text>
                        <text x="440" y="470" class="entity-attr">• status, type, sla_state</text>
                        <text x="440" y="490" class="entity-attr">• created_at, updated_at</text>

                        <rect x="760" y="320" width="240" height="180" class="entity"></rect>
                        <text x="880" y="360" text-anchor="middle" class="entity-header">TicketComment</text>
                        <text x="780" y="390" class="entity-attr">• id (PK)</text>
                        <text x="780" y="410" class="entity-attr">• ticket_id (FK)</text>
                        <text x="780" y="430" class="entity-attr">• author_id (FK)</text>
                        <text x="780" y="450" class="entity-attr">• body, is_internal</text>
                        <text x="780" y="470" class="entity-attr">• created_at</text>

                        <rect x="1020" y="320" width="220" height="180" class="entity"></rect>
                        <text x="1130" y="360" text-anchor="middle" class="entity-header">TicketAttachment</text>
                        <text x="1040" y="390" class="entity-attr">• id (PK)</text>
                        <text x="1040" y="410" class="entity-attr">• ticket_id (FK)</text>
                        <text x="1040" y="430" class="entity-attr">• author_id (FK)</text>
                        <text x="1040" y="450" class="entity-attr">• file, created_at</text>

                        <rect x="120" y="540" width="240" height="180" class="entity"></rect>
                        <text x="240" y="580" text-anchor="middle" class="entity-header">TicketAssignment</text>
                        <text x="140" y="610" class="entity-attr">• id (PK)</text>
                        <text x="140" y="630" class="entity-attr">• ticket_id (FK)</text>
                        <text x="140" y="650" class="entity-attr">• assignee_id (FK)</text>
                        <text x="140" y="670" class="entity-attr">• assigned_at</text>

                        <rect x="420" y="560" width="280" height="180" class="entity"></rect>
                        <text x="560" y="600" text-anchor="middle" class="entity-header">AuditLog</text>
                        <text x="440" y="630" class="entity-attr">• id (PK)</text>
                        <text x="440" y="650" class="entity-attr">• ticket_id (FK)</text>
                        <text x="440" y="670" class="entity-attr">• actor_id (FK)</text>
                        <text x="440" y="690" class="entity-attr">• action, metadata</text>
                        <text x="440" y="710" class="entity-attr">• created_at</text>

                        <line x1="340" y1="160" x2="420" y2="160" class="relationship-line"></line>
                        <text x="360" y="150" class="cardinality">1</text>
                        <text x="400" y="150" class="cardinality">N</text>
                        <text x="360" y="170" class="relationship-label">Solicita</text>

                        <line x1="340" y1="200" x2="420" y2="340" class="relationship-line"></line>
                        <text x="360" y="270" class="cardinality">1</text>
                        <text x="420" y="300" class="cardinality">N</text>
                        <text x="360" y="290" class="relationship-label">Asignado</text>

                        <line x1="640" y1="160" x2="720" y2="160" class="relationship-line"></line>
                        <text x="660" y="150" class="cardinality">1</text>
                        <text x="700" y="150" class="cardinality">N</text>

                        <line x1="830" y1="260" x2="560" y2="300" class="relationship-line"></line>
                        <text x="720" y="270" class="cardinality">1</text>
                        <text x="600" y="300" class="cardinality">N</text>

                        <line x1="960" y1="260" x2="560" y2="320" class="relationship-line"></line>
                        <text x="880" y="270" class="cardinality">1</text>
                        <text x="640" y="320" class="cardinality">N</text>

                        <line x1="340" y1="400" x2="420" y2="420" class="relationship-line"></line>
                        <text x="360" y="390" class="cardinality">1</text>
                        <text x="400" y="390" class="cardinality">N</text>

                        <line x1="700" y1="420" x2="760" y2="410" class="relationship-line"></line>
                        <text x="720" y="400" class="cardinality">1</text>
                        <text x="770" y="400" class="cardinality">N</text>

                        <line x1="700" y1="460" x2="1020" y2="410" class="relationship-line"></line>
                        <text x="820" y="430" class="cardinality">1</text>
                        <text x="980" y="420" class="cardinality">N</text>

                        <line x1="560" y1="520" x2="560" y2="560" class="relationship-line"></line>
                        <text x="540" y="540" class="cardinality">1</text>
                        <text x="580" y="540" class="cardinality">N</text>

                        <line x1="340" y1="620" x2="420" y2="640" class="relationship-line"></line>
                        <text x="360" y="610" class="cardinality">1</text>
                        <text x="400" y="610" class="cardinality">N</text>
                    </svg>
                    <div class="der-note">
                        Category y Subcategory normalizan el catálogo; Ticket vincula usuarios solicitantes y asignados además de prioridad, área y subcategoría. Comentarios, adjuntos, asignaciones y auditoría dependen del ticket y registran actor, fechas y visibilidad interna. SLA se deriva de Priority.sla_hours y genera eventos en AuditLog.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const panelOverlay = document.getElementById('panels');
        const diagramButtons = document.querySelectorAll('.diagram-button');
        const panels = document.querySelectorAll('.panel');
        const closeButtons = document.querySelectorAll('[data-close]');

        diagramButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const panelId = btn.dataset.panel;
                const targetPanel = document.getElementById(panelId);

                panels.forEach(panel => panel.classList.remove('active'));
                panelOverlay.classList.add('visible');
                requestAnimationFrame(() => {
                    targetPanel.classList.add('active');
                    const scrollable = targetPanel.querySelector('.panel-body');
                    if (scrollable) {
                        scrollable.scrollTop = 0;
                    }
                });
            });
        });

        closeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                panels.forEach(panel => panel.classList.remove('active'));
                panelOverlay.classList.remove('visible');
                resetActors();
            });
        });

        panelOverlay.addEventListener('click', event => {
            if (event.target === panelOverlay) {
                panels.forEach(panel => panel.classList.remove('active'));
                panelOverlay.classList.remove('visible');
                resetActors();
            }
        });

        const actorGroups = document.querySelectorAll('.actor');
        const usecaseShapes = document.querySelectorAll('.usecase');
        const usecaseLabels = document.querySelectorAll('.usecase-label');
        const connectors = document.querySelectorAll('.connector');
        const usecaseInfo = document.getElementById('usecase-info');
        const initialResetButton = document.getElementById('reset-actors');

        const actorData = {
            solicitante: {
                label: 'Solicitante',
                cases: [
                    'Iniciar sesión / Cerrar sesión',
                    'FAQ autoservicio',
                    'Ver y filtrar tickets',
                    'Crear ticket',
                    'Adjuntar y comentar'
                ],
                relationships: [
                    'FAQ autoservicio extiende la creación solo si no resuelve la consulta.',
                    'Crear ticket incluye validar permisos por rol y registrar auditoría.',
                    'Adjuntar y comentar incluye trazabilidad en auditoría.'
                ],
                rules: [
                    'Tipos permitidos: REQUEST | INCIDENT definidos al crear el ticket.',
                    'Estado inicial OPEN con flujo OPEN → IN_PROGRESS → RESOLVED → CLOSED.',
                    'Adjuntos guardados en /media con AuditLog(action=ATTACH).'
                ],
                usecases: ['usecase-login', 'usecase-faq', 'usecase-ver', 'usecase-crear', 'usecase-adjuntar'],
                connectors: [
                    'conn-solicitante-login', 'conn-solicitante-faq', 'conn-solicitante-ver',
                    'conn-solicitante-crear', 'conn-solicitante-adjuntar'
                ]
            },
            tecnico: {
                label: 'Técnico',
                cases: [
                    'Iniciar sesión / Cerrar sesión',
                    'Ver y filtrar tickets',
                    'Adjuntar y comentar',
                    'Cambiar estado',
                    'Asignar / Reasignar',
                    'Dashboard KPI'
                ],
                relationships: [
                    'Cambiar estado incluye auditoría (registro STATUS).',
                    'Asignar/Reasignar incluye auditoría (registro ASSIGN).',
                    'Dashboard KPI incluye validar permisos por rol.',
                    'Adjuntar y comentar puede extender la creación agregando evidencia inicial.'
                ],
                rules: [
                    'Permisos otorgados vía grupos de Django (rol técnico).',
                    'Priority.sla_hours controla eventos SLA_WARN y SLA_BREACH.',
                    'Histórico de asignaciones en TicketAssignment; sincroniza assigned_to.'
                ],
                usecases: [
                    'usecase-login', 'usecase-ver', 'usecase-adjuntar',
                    'usecase-estado', 'usecase-asignar', 'usecase-dashboard'
                ],
                connectors: [
                    'conn-tecnico-login', 'conn-tecnico-ver', 'conn-tecnico-adjuntar',
                    'conn-tecnico-estado', 'conn-tecnico-asignar', 'conn-tecnico-dashboard'
                ]
            },
            administrador: {
                label: 'Administrador',
                cases: [
                    'Iniciar sesión / Cerrar sesión',
                    'Ver y filtrar tickets',
                    'Asignar / Reasignar',
                    'Dashboard KPI',
                    'Gestionar catálogos',
                    'Exportar PDF / Excel',
                    'Auditoría'
                ],
                relationships: [
                    'Exportar PDF/Excel incluye el resultado filtrado actual.',
                    'Gestionar catálogos incluye validar permisos por rol.',
                    'Auditoría se incluye en acciones críticas.',
                    'Validar permisos controla acceso administrativo.'
                ],
                rules: [
                    'Catálogos normalizados en mayúsculas (Category, Subcategory, Priority, Area).',
                    'Auditoría registra CREATE/ASSIGN/STATUS/COMMENT/ATTACH/SLA.',
                    'Exportar respeta filtros activos del dashboard.'
                ],
                usecases: [
                    'usecase-login', 'usecase-ver', 'usecase-asignar',
                    'usecase-dashboard', 'usecase-catalogos', 'usecase-exportar',
                    'usecase-auditoria', 'usecase-permisos'
                ],
                connectors: [
                    'conn-admin-login', 'conn-admin-ver', 'conn-admin-asignar',
                    'conn-admin-dashboard', 'conn-admin-catalogos', 'conn-admin-exportar',
                    'conn-admin-auditoria'
                ]
            }
        };

        function clearDiagramHighlights() {
            actorGroups.forEach(actor => actor.classList.remove('active'));
            usecaseShapes.forEach(shape => shape.classList.remove('active'));
            usecaseLabels.forEach(label => label.classList.remove('active'));
            connectors.forEach(line => line.classList.remove('active'));
        }

        function renderActorInfo(actorKey) {
            const data = actorData[actorKey];
            if (!data) return;

            usecaseInfo.innerHTML = `
                <h3>${data.label}</h3>
                <div>
                    <h4>Casos de uso</h4>
                    <ul>${data.cases.map(item => `<li>${item}</li>`).join('')}</ul>
                </div>
                <div>
                    <h4>Relaciones</h4>
                    <ul>${data.relationships.map(item => `<li>${item}</li>`).join('')}</ul>
                </div>
                <div>
                    <h4>Reglas de negocio</h4>
                    <ul>${data.rules.map(item => `<li>${item}</li>`).join('')}</ul>
                </div>
                <button class="reset-selection" id="reset-actors" type="button">Limpiar selección</button>
            `;

            usecaseInfo.querySelector('#reset-actors').addEventListener('click', resetActors);
        }

        function activateActor(actorKey) {
            clearDiagramHighlights();
            const actorElement = document.querySelector(`[data-actor="${actorKey}"]`);
            if (actorElement) {
                actorElement.classList.add('active');
            }

            const data = actorData[actorKey];
            if (!data) return;

            data.usecases.forEach(id => {
                const node = document.getElementById(id);
                if (node) {
                    node.classList.add('active');
                }
                const label = document.querySelector(`.usecase-label[data-usecase="${id}"]`);
                if (label) {
                    label.classList.add('active');
                }
            });

            data.connectors.forEach(id => {
                const connector = document.getElementById(id);
                if (connector) {
                    connector.classList.add('active');
                }
            });

            renderActorInfo(actorKey);
        }

        function resetActors() {
            clearDiagramHighlights();
            usecaseInfo.innerHTML = `
                <h3>Selecciona un actor</h3>
                <p class="info-note">El detalle de casos, relaciones y reglas aparecerá aquí al activar un actor.</p>
                <button class="reset-selection" id="reset-actors" type="button">Limpiar selección</button>
            `;
            usecaseInfo.querySelector('#reset-actors').addEventListener('click', resetActors);
        }

        actorGroups.forEach(actor => {
            actor.addEventListener('click', () => {
                activateActor(actor.dataset.actor);
            });
        });

        initialResetButton.addEventListener('click', resetActors);
    </script>
</body>
</html>
